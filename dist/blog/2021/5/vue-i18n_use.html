
    <!DOCTYPE html>
    <html lang="zh-CN">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <meta name="application name" content="vue-i18n_use.html">
        <meta name="author" content="guoqzuo">
        <meta name="description" content="vue 国际化, Vue 国际化最佳实践, vue-i18n最佳实践, vue-i18n模块化方案, 在 'Vue 使用 vue-i18n 国际化' 中，我们简单介绍了 vue-i18n 的基本使用。如果想将它实际应用到项目中，我们还需要考虑怎么做到更加简洁、优雅、可维护，下面是一些实践总结。1. i18n 单独放一个目录，避免在 main.js 中写入太多内容 2. 方便实时测试：语言切换组件 3. 避免单文件过大、混乱：模块化 4. 列表渲染（code 值）处理：js 取值、过滤器 filter 设计">
        <meta name="keywords" content="vue 国际化,Vue 国际化最佳实践,vue-i18n最佳实践,vue-i18n模块化方案">

        <title>Vue 国际化 vue-i18n 相关用法、实践总结 - 左小白的技术日常</title>
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link href="/lib/prismjs/prism_default.css" rel="stylesheet" />
        <link href="/lib/notes.css" rel="stylesheet" />
        <link rel="stylesheet" href="/lib/global.css">
        
      </head>
      <body>
        <header>
          <div>
            <img src="/images/logo.png" width="24" height="24" class="pointer" onclick="gotoIndex()" />
            <span class="pointer" onclick="gotoIndex()">左小白的技术日常</span>
            <span class="hidden"> | </span>
            <a href="/blog/category.html#vue" class="hidden">Vue</a>
          </div>
          <div>
            
          <a href="http://fe.zuo11.com" target="_black" class="hidden">我的笔记</a>
        
          <a href="https://github.com/zuoxiaobai" target="_black" class="">Github</a>
        
          </div>
        </header>
        <section class="content">
          <article>
            <h1 id="vue-国际化-vue-i18n-相关用法、实践总结">Vue 国际化 vue-i18n 相关用法、实践总结</h1>
            
    <div class="article-top">
      <div class="flex">
        这篇文章发布于 2021/05/04，归类于 <a href="/blog/category.html#vue" class="hidden">Vue</a>
        <!-- ，阅读 11 次，今日 1 次 <div class="top-comment">4 条评论</div> -->
        <div id="readAndComment" class="flex"></div>
      </div> 
      <div class="flex keywords" style="flex-wrap: nowrap;">
        <div style="flex-shrink:0; align-self: flex-start;">标签：</div>
        <div class="flex" style="flex-wrap: wrap;"><span>vue 国际化</span>，<span>Vue 国际化最佳实践</span>，<span>vue-i18n最佳实践</span>，<span>vue-i18n模块化方案</span></div>
      </div>
    </div>
    
  
            
<p>在 <a href="http://www.zuo11.com/blog/2021/4/vue_international.html">Vue 使用 vue-i18n 国际化 - 左小白的技术日常</a> 中，我们简单介绍了 vue-i18n 的基本使用。如果想将它实际应用到项目中，我们还需要考虑怎么做到更加简洁、优雅、可维护，下面是一些实践总结。</p>
<h2 id="1-i18n-单独放一个目录，避免在-mainjs-中写入太多内容">1. i18n 单独放一个目录，避免在 main.js 中写入太多内容</h2>
<p>i18n 相关内容较多，如果都写在 main.js 里，内容会很多，不够优雅，这里可以进行简单封装。在 src 目录下新建一个 i18n 目录，专门用于存放国际化相关内容，使用 index.js 作为入口文件</p>
<pre><code class="language-js">// src/i18n/index.js
import Vue from &quot;vue&quot;;
import VueI18n from &quot;vue-i18n&quot;;

Vue.use(VueI18n);

const i18n = new VueI18n({
  locale: &quot;zh-CN&quot;, // 设置默认语言环境
  // 在 vue template 的 {{}} 中，使用 $t(&#39;un&#39;) 即可拿到 un 属性指定的值
  // 不需要在 data() {} 中设置什么
  messages: {
    en: {
      name: &quot;Zhang san&quot;,
      hello: &quot;hello world&quot;
    },
    &quot;zh-CN&quot;: {
      name: &quot;张三&quot;,
      hello: &quot;你好，世界&quot;
    }
  }
});

export default i18n; // 将 i18n 实例导出，用于在 new Vue 时引入</code></pre>
<p>这样，我们在 main.js 就只需要修改两行就可以了</p>
<pre><code class="language-js">// main.js
// ...
import i18n from &quot;./i18n/index&quot;; // 引入 src/i18n/index，得到 i18n 实例

new Vue({
  i18n, // 在 new Vue() 时加入 i18n
  router,
  store,
  render: h =&gt; h(App)
}).$mount(&quot;#app&quot;);</code></pre>
<h2 id="2-方便实时测试：语言切换组件">2. 方便实时测试：语言切换组件</h2>
<p>在测试国际化时，改代码的方式切国际化语言不够方便。我们可以做一个测试用的语言切换组件，在主页面引入后，会出现在页面右上角，方便调试。相关配置存到 lcoalStorage 中，防止调试时刷新页面后需要再次手动切换语言。</p>
<p><img src="../../../images/blog/vue/i18n-lang-change.gif" alt="i18n-lang-change.gif"></p>
<pre><code class="language-html">&lt;!-- BaseLanguageSelect.vue --&gt;
&lt;template&gt;
  &lt;div class=&quot;demo-i18n&quot;&gt;
    国际化测试：
    &lt;el-select v-model=&quot;lang&quot; @change=&quot;langChange&quot;&gt;
      &lt;el-option label=&quot;中文&quot; value=&quot;zh-CN&quot;&gt;&lt;/el-option&gt;
      &lt;el-option label=&quot;英语&quot; value=&quot;en&quot;&gt;&lt;/el-option&gt;
    &lt;/el-select&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
// 将当前语言存到 localStorage 中的字段，要特殊，防止和其他项目冲突
const LANG_NAME = &quot;demo-lang&quot;;
export default {
  data() {
    return {
      lang: &quot;en&quot;
    };
  },
  created() {
    // 从 localStorage 中读取默认语言，便于页面刷新后调试
    this.lang = localStorage.getItem(LANG_NAME) || &quot;en&quot;;
    // 设置到 i18n
    this.$i18n.locale = this.lang;
  },
  methods: {
    // 语言切换后，设置到 i18n、localStorage
    langChange(value) {
      this.$i18n.locale = value;
      localStorage.setItem(LANG_NAME, value);
    }
  }
};
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;
.demo-i18n {
  position: absolute;
  top: 10px;
  right: 10px;
}
&lt;/style&gt;</code></pre>
<p>使用示例</p>
<pre><code class="language-html">&lt;!-- i18nTest.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;BaseLanguageSelect /&gt;
    {{ $t(&quot;name&quot;) }}, {{ $t(&quot;hello&quot;) }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  components: {
    BaseLanguageSelect: () =&gt; import(&quot;./BaseLanguageSelect&quot;)
  }
};
&lt;/script&gt;</code></pre>
<h2 id="3-避免单文件过大、混乱：模块化">3. 避免单文件过大、混乱：模块化</h2>
<p>当项目较大、国际化内容较多时，如果将全部内容都写在 i18n/index.js 主文件中，有两个缺点：</p>
<ul>
<li>i18n/index.js 内容太多，不好查找</li>
<li>多人同时维护时，容易产生冲突，合并代码一不小心就会合出问题</li>
</ul>
<p>这就需要模块化了，怎么优雅的模块化呢？下面是我的一些思考，仅供参考</p>
<ul>
<li>按功能模块划分、不同的模块放到不同的目录、不同的语言使用不同的文件</li>
<li>新增模块和语言时，最小化改动公共文件 i18n/index.js</li>
</ul>
<p>目录结构规划如下</p>
<pre><code class="language-bash">├── i18n
│   ├── base # 通用模块，想用 common 但是使用时，模块名越短越方便，改为 base 
│   │   ├── en.js
│   │   └── zh-CN.js 
│   ├── user # 用户模块
│   │   ├── en.js
│   │   └── zh-CN.js 
│   ├── xxx # 其他模块
│   │   ├── en.js
│   │   └── zh-CN.js 
│   └── index.js # 入口文件、导出 i18n 实例</code></pre>
<p>这里就需要重构 i18n/index.js 了，利用 import() 动态导入，使用 modules 模块数组，languages 语言数组，自动去合并、整理 messages。后面新增模块或新增语言非常方便、快捷，代码如下</p>
<pre><code class="language-js">import Vue from &quot;vue&quot;;
import VueI18n from &quot;vue-i18n&quot;;

Vue.use(VueI18n);

/**
 * @description 根据模块、语言提取 messages
 * @author zuoxiaobai &lt;i@zuoguoqing.com&gt;
 * @param { Array } modules [&quot;base&quot;, &quot;user&quot;]; // 模块数组
 * @param { Array } languages [&quot;en&quot;, &quot;zh-CN&quot;]; // 语言数组
 * @returns { Object} messages
 */
function getMessages(modules, languages) {
  // 初始化 messages { en: {}, zh-CN: {}}
  let messages = {};
  languages.forEach(lang =&gt; {
    messages[lang] = {};
  });

  // 遍历模块，将内容添加到 messages.语言.上
  modules.forEach(moduleName =&gt; {
    languages.forEach(async lang =&gt; {
      // 加 try ... catch 防止语言文件缺失 import 报 error，影响执行
      try {
        let { default: obj } = await import(&quot;./&quot; + `${moduleName}/${lang}.js`);
        // { en: { base: { } }, zh-CN: { base: {} }}
        !messages[lang][moduleName] &amp;&amp; (messages[lang][moduleName] = {});
        Object.assign(messages[lang][moduleName], obj);
      } catch (e) {
        console.warn(e.message);
      }
    });
  });
  console.log(messages);
  return messages;
}

const modules = [&quot;base&quot;, &quot;user&quot;]; // 模块数组
const languages = [&quot;en&quot;, &quot;zh-CN&quot;, &quot;zh-TW&quot;]; // 语言数组
let messages = getMessages(modules, languages);

const i18n = new VueI18n({
  locale: &quot;zh-CN&quot;, // 设置默认语言环境
  messages
  // messages: {
  //   en: {
  //     name: &quot;Zhang san&quot;,
  //     hello: &quot;hello world&quot;
  //   },
  //   &quot;zh-CN&quot;: {
  //     name: &quot;张三&quot;,
  //     hello: &quot;你好，世界&quot;
  //   }
  // }
});

export default i18n;</code></pre>
<p>合并后的效果如下图，不同的模块放到不同的大对象上</p>
<p><img src="../../../images/blog/vue/i18n-modlues.png" alt="i18n-modlues.png"></p>
<p>在 vue 组件中使用时，加上模块前缀即可</p>
<pre><code class="language-html">&lt;template&gt;
  &lt;div&gt;
    &lt;BaseLanguageSelect /&gt;
    &lt;!-- {{ $t(&quot;name&quot;) }}, {{ $t(&quot;hello&quot;) }} --&gt;
    {{ $t(&quot;user.name&quot;) }}, {{ $t(&quot;user.hello&quot;) }}
    {{ $t(&quot;base.year&quot;) }}, {{ $t(&quot;base.month&quot;) }}, {{ $t(&quot;base.time&quot;) }}
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<h2 id="4-列表渲染（code-值）处理：js-取值、过滤器-filter-设计">4. 列表渲染（code 值）处理：js 取值、过滤器 filter 设计</h2>
<p>对于列表相关国际化，如果是前端纯展示还好，我们直接遍历即可，以 currency 币种为例，纯展示可以像下面这样写</p>
<pre><code class="language-html">&lt;!-- currencys: [&quot;RMB&quot;, &quot;USD&quot;, &quot;HKD&quot;] --&gt;
&lt;!-- currencys: [&quot;人民币&quot;, &quot;美元&quot;, &quot;港币&quot;] --&gt;
&lt;div v-for=&quot;item in $t(&#39;base.currencys&#39;)&quot; :key=&quot;item&quot;&gt;{{ item }}&lt;/div&gt;</code></pre>
<p>但如果涉及到表单，就需要一些处理了。比如表单中需要选择币种，一般每个币种会对应不同的 code，我们需要处理两个问题：</p>
<ol>
<li>用户选择国际化币种后，表单 v-model 值自动变成 code</li>
<li>当后端返回币种 code 时，前端可以渲染其国际化币种显示</li>
</ol>
<p>可以在国际化中新增一个字段比如 currencysCode，按照字段顺序一一对应，比如 currencyCodes: [&#39;10&#39;, &#39;12&#39;, &#39;15&#39;]，这样根据 index，可以将 code 设置到表单的 value 中，另外知道 code 计算国际化文本时，可以使用 filter，从 this.$i18n 这个变量中，通过 js 来取值，例子如下</p>
<pre><code class="language-html">&lt;template&gt;
  &lt;div&gt;
    &lt;BaseLanguageSelect /&gt;

    当前币种：{{ currency | currencyText($i18n) }} {{ currency }}
    &lt;el-select v-model=&quot;currency&quot;&gt;
      &lt;el-option
        v-for=&quot;(item, index) in $t(&#39;base.currencys&#39;)&quot;
        :key=&quot;item&quot;
        :label=&quot;item&quot;
        :value=&quot;$t(&#39;base.currencyCodes&#39;)[index]&quot;
      &gt;&lt;/el-option&gt;
    &lt;/el-select&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  components: {
    BaseLanguageSelect: () =&gt; import(&quot;./BaseLanguageSelect&quot;)
  },

  filters: {
    currencyText: function(code, i18n) {
      // filter 中不能使用 this，需要传参数 this.$i18n
      // console.log(this); // undefined
      let { currencys, currencyCodes } = i18n.messages[i18n.locale].base;
      // 根据 code 找到对应的 index
      let index = currencyCodes.indexOf(code);
      return currencys[index];
    }
  },
  data() {
    return {
      currency: &quot;&quot;
    };
  }
};
&lt;/script&gt;</code></pre>
<p>除了在国际化中，加入对应的 code 对应关系字段外，也可以单独用一个 const 文件来保存 code。当语言种类不多的情况下，感觉直接放到国际化字段中会简单一点，操作时不用额外引入文件。</p>
<p>除了模板语法写法外，我们也可以通过 Vue 的实例属性 this.$i18n. 来操作国际化数据，这样基本就可以处理所有情况了。</p>

            
            <ins class='adsbygoogle' style='display:block;margin-top:1em;margin-bottom:0' data-ad-format='fluid' data-ad-layout-key='-gw-3+1f-3d+2z' data-ad-client='ca-pub-9527676606416641' data-ad-slot='8870245163'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            <!-- 评论系统占位 -->
            <div id="commentDiv"></div>
          </article>

          <aside>
            <div class="aside-wrap">
              <div class="top ">
                <ul><li><span class="ul-span" data-id="vue-国际化-vue-i18n-相关用法、实践总结" style="padding-left:1em">Vue 国际化 vue-i18n 相关用法、实践总结<span></li><ul><li><span class="ul-span" data-id="1-i18n-单独放一个目录，避免在-mainjs-中写入太多内容" style="padding-left:2em">1. i18n 单独放一个目录，避免在 main.js 中写入太多内容<span></li></ul><ul><li><span class="ul-span" data-id="2-方便实时测试：语言切换组件" style="padding-left:2em">2. 方便实时测试：语言切换组件<span></li></ul><ul><li><span class="ul-span" data-id="3-避免单文件过大、混乱：模块化" style="padding-left:2em">3. 避免单文件过大、混乱：模块化<span></li></ul><ul><li><span class="ul-span" data-id="4-列表渲染（code-值）处理：js-取值、过滤器-filter-设计" style="padding-left:2em">4. 列表渲染（code 值）处理：js 取值、过滤器 filter 设计<span></li></ul></ul>
              </div>
              <ins class='adsbygoogle' style='display:block;width:300px;height:250px;' data-ad-client='ca-pub-9527676606416641' data-ad-slot='9476232907'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
          </aside>
        </section>
        <footer>
          <div class="footer_content">
            <div class="footer_right">Copyright © 2016-2021 zuo11.com. <a href='http://beian.miit.gov.cn/'>鄂ICP备16014741号-1</a></div>
            <div>Powered by <a href='https://github.com/zuoxiaobai/zuo-blog' target='_black'>zuo-blog</a></div>
          </div>
        </footer>
        <script src="/lib/prismjs/prism_default.js"></script>
        <script src="/lib/notes.js"></script> 
        <script src="/lib/global.js"></script>
        <script>
          
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?183281668cc3440449274d1f93c04de6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-178732583-1"></script> -->
<script>
  // window.dataLayer = window.dataLayer || [];
  // function gtag(){dataLayer.push(arguments);}
  // gtag('js', new Date());
  // gtag('config', 'UA-178732583-1');

  window.onload = function() {
    setTimeout(function() {
      let script = document.createElement("script");
      script.setAttribute("data-ad-client", "ca-pub-9527676606416641");
      script.setAttribute("async", "");
      script.src = "//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js";
      document.body.appendChild(script);
    }, 200);
  }
</script>

      </body>
    </html>
  