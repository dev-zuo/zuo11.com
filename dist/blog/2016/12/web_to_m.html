
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <meta name="application name" content="web_to_m.html">
        <meta name="author" content="guoqzuo">
        <meta name="description" content="移动端适配">
        <meta name="keywords" content="zuo11.com站点优化记录,PC站转移动站,移动端适配">

        <title>移动端适配 - 左小白的技术日常</title>
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link href="/lib/prismjs/prism_default.css" rel="stylesheet" />
        <link href="/lib/notes.css" rel="stylesheet" />
      </head>
      <body>
        <header>
          <div>
            <img src="/images/logo.png" width="24" height="24" class="pointer" onclick="gotoIndex()" />
            <span class="pointer" onclick="gotoIndex()">左小白的技术日常</span>
            <span class="hidden"> | </span>
            <a href="/blog/category.html#web" class="hidden">web</a>
          </div>
          <div>
            
          <a href="https://www.yuque.com/guoqzuo" target="_black" class="hidden">语雀</a>
        
          <a href="https://github.com/zuoxiaobai" target="_black" class="">Github</a>
        
          </div>
        </header>
        <section class="content">
          <article>
            
    <div class="article-top">
      <div>2016/12/24</div> 
      <div class="article-top-right">Author: guoqzuo</div>
    </div>
  
            <h1 id="移动端适配">移动端适配</h1>
<blockquote>
<p>最近一有时间就刷刷百度站长/百度统计，展现量和收录没怎么变化，上不去。虽然从表面上看站点已经OK了，但网站的流量想要做上去，离不开搜索引擎。流量就是一切，想要做好网站就必须做好SEO，现在主要的问题是移动端的处理，百度从搜索引擎的角度将对移动端的处理方式分为三种，现在我的实现很尴尬，界定模糊。</p>
</blockquote>
<p><img src="../../../images/blog/web/web_to_m_1.png" alt="web_to_m_1.png"></p>
<h2 id="跳转方式">跳转方式</h2>
<p>现在zuo11.com的跳转方式又像跳转适配又像代码适配，当访问站点时，浏览器通过链接向服务器发出请求。web.xml配置了默认打开index.woe的servlet页面，获取数据库内容后转发给前端页index.jsp，Tomcat解析完成后生成html传回给浏览器。</p>
<pre><code class="language-java">if (request.getParameter(&quot;action&quot;) != null) {
    request.getRequestDispatcher(&quot;m_index.jsp&quot;).forward(request, response);
} else {
    request.getRequestDispatcher(&quot;index.jsp&quot;).forward(request, response);
}</code></pre>
<p>第一次访问时action肯定是null，就进了index.jsp。这个页面我用了js来判断是否为移动端，如果是就再次请求index.woe但传了一个action值，使页面跳转到另一个页面m_index.jsp。</p>
<pre><code class="language-java">document.ready = start;
function start(){
    if (navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)) {
        window.location.href = &quot;index.woe?action=m&quot;;
    }
}</code></pre>
<p>站点前端只用了三个页面来完成: index.jsp, notes.jsp, about.jsp，分别有相应的移动处理页面m_index.jsp, m_notes.jsp, m_about.jsp。由于是servlet的forward，表面上的链接其实是</p>
<pre><code class="language-bash">主页:
http://zuo11.com/index.woe    对应index.jsp
http://zuo11.com/index.woe?action=m 对应m_index.jsp 
笔记分类:ios/apue等
http://zuo11.com/Notes.woe?action=iOS 对应notes.jsp 
http://zuo11.com/Notes.woe?mobile=true&amp;action=iOS  对应m_notes.jsp 
笔记详情:
http://zuo11.com/Notes.woe?action=detail&amp;note_id=55 对应notes.jsp 
http://zuo11.com/Notes.woe?mobile=true&amp;action=detail&amp;note_id=55 对应m_notes.jsp 
关于:
http://zuo11.com/Timeline.woe 对应about.jsp 
http://zuo11.com/Timeline.woe?action=m 对应m_about.jsp</code></pre>
<p>从上面的分类来看有跳转，像是跳转适配，但我更倾向于第二种代码适配，所以得把网址url弄成一样，因为如果同一篇文章如果有两个链接，那么百度收录怎么怎么处理，明显同一篇文章，同一个链接更适合收录，所以我想用session来处理，根据session的值来判断是否转发值，这样三个页面我都需要检测浏览器的版本，判断session，防止非主页进入本站。</p>
<h2 id="百度推荐">百度推荐</h2>
<p>关于移动配置，百度不建议的做法: </p>
<ul>
<li>单一域名下请使用同一种配置方式(跳转适配、代码适配、自适应)，例如，不要把移动站的页面作为pc站网址中的一个子目录来配置。</li>
<li>如果使用跳转适配的方式，请不要使用JS对ua进行适配跳转。这种方式存在两个缺点：<ul>
<li>对用户：会加大由重定向的客户端造成的延迟；这是因为客户端需要先下载网页，接着解析并执行JavaScript，然后才能触发重定向。301或302则不会有这个延迟。</li>
<li>对搜索：爬虫也需要使用支持JS渲染的爬虫，才能发现此重定向。</li>
</ul>
</li>
</ul>
<p>现在这两点我全占了，目前能想到的最合适的处理方法就是在js的ready函数里，判断是否为移动端并设置session。或者可以试试ajax传值。其次是找到除js外判断是否为移动端并跳转的方法。之后还要用MIP改造移动端。</p>
<p>参考资料:</p>
<p><a href="https://ziyuan.baidu.com/college/courseinfo?id=156">百度站长平台-移动搜索</a></p>
<p>2016-12-25 06:24:26 更新</p>
<p>距离写上面一大堆的内容不过10小时，现在发现在这之前自己是多么的low，明明是很简单的一个问题，但当你不知道怎么处理时，就很头疼，当知道了后就豁然开朗了，不知道这是多少次有这种感觉，每有一次就算是进步了。不管遇到什么问题，总会解决的。解决方法: java web判断是否为移动端访问</p>

          </article>
          <aside>
            <div>
              <ul><li><span class="ul-span" data-id="移动端适配" style="padding-left:1em">移动端适配<span></li><ul><li><span class="ul-span" data-id="跳转方式" style="padding-left:2em">跳转方式<span></li></ul><ul><li><span class="ul-span" data-id="百度推荐" style="padding-left:2em">百度推荐<span></li></ul></ul>
            <div>
          </aside>
        </section>
        <footer>
          <div class="footer_content">
            <div class="footer_right">Copyright © 2016-2020 zuo11.com. 鄂ICP备16014741号-1</div>
            <div>Powered by <a href='https://github.com/zuoxiaobai/zuo-blog' target='_black'>zuo-blog</a></div>
          </div>
        </footer>
        <script src="/lib/prismjs/prism_default.js"></script>
        <script>
          let asideDiv = document.getElementsByTagName('aside')[0]
          asideDiv.onclick = (e) => {
            let id = e.target.dataset.id
            if (!id) return
            // 移除所有的active
            let nodes = document.getElementsByClassName('ul-span')
            for (let i = 0, len = nodes.length; i < len; i++) {
              nodes[i].classList.remove('active')
            }
            e.target.classList.add('active')
            document.getElementById(id).scrollIntoView(true)
            document.documentElement.scrollBy(0, -70)
          }

          let headersArr = []

          // 通过category.html#web进入页面时, 由于顶部fixed会有遮挡，fix方案
          window.onload = () => {
            // 如果是category，且有hash值，向上滚动 -70
            let { pathname, hash } = location
            pathname.includes('category.html') && hash && document.documentElement.scrollBy(0, -70)

            // 将每个标题的高度，存到数组里，当滚动时，自动focus右侧大纲
            let nodes = document.getElementsByClassName('ul-span')
            for (let i = 0, len = nodes.length; i < len; i++) {
              // console.log(nodes.dataset)
              let id = nodes[i].dataset.id
              headersArr.push({id: id, offsetTop: document.getElementById(id).offsetTop})
            }
            // console.log(headersArr)

            window.onscroll = () => {
              focusAsideSpan()
              // debounce(focusAsideSpan)
            }
          }

          // 效果不好，没有实时滚动的感觉，关闭防抖
          // function debounce(method, context) {
          //   clearTimeout(method.tId)
          //   method.tId = setTimeout(function() {
          //     method.call(context)
          //   }, 100)
          // }
          
          function focusAsideSpan() {
            let scrollTop = document.documentElement.scrollTop
            let curNode
            for (let i = 0, len = headersArr.length; i < len; i++) {
              if (headersArr[i].offsetTop - scrollTop >= 0) {
                // 移除所有的active
                let nodes = document.getElementsByClassName('ul-span')
                for (let j = 0, len = nodes.length; j < len; j++) {
                  if (headersArr[i].id === nodes[j].dataset.id) {
                    nodes[j].classList.remove('active')
                    nodes[j].classList.add('active')
                  } else {
                    nodes[j].classList.remove('active')
                  }
                }
                return
              }
            }
            // 如果走到这里，说明滚到底部了
            // 移除所有的active
            let nodes = document.getElementsByClassName('ul-span')
            for (let i = 0, len = nodes.length; i < len; i++) {
              nodes[i].classList.remove('active')
            }
            nodes[nodes.length - 1].classList.add('active')
          }


          function gotoIndex() {
            window.location.href = "/"
          }

          
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?183281668cc3440449274d1f93c04de6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    

        </script>
      </body>
    </html>
  