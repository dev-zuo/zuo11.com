
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <meta name="application name" content="web_address_list.html">
        <meta name="author" content="guoqzuo">
        <meta name="description" content="小马哥视频里讲的通讯录小例子登录界面用了动画，用的是storyboard拖线跳转，顺便讲了segue，页面传值及发送通知。这里简单的实现通讯录的基本功能，动画就不做了，主要练习页面的跳转以及tableView相关使用，只是了解基本的使用，可以根据实际情况进行优化。">
        <meta name="keywords" content="UITableView的使用,通讯录小例子,UITableView左滑删除功能">

        <title>iOS通讯录小列子 - 左小白的技术日常</title>
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link href="/lib/prismjs/prism_default.css" rel="stylesheet" />
        <link href="/lib/notes.css" rel="stylesheet" />
        <link rel="stylesheet" href="/lib/global.css">
        
      </head>
      <body>
        <header>
          <div>
            <img src="/images/logo.png" width="24" height="24" class="pointer" onclick="gotoIndex()" />
            <span class="pointer" onclick="gotoIndex()">左小白的技术日常</span>
            <span class="hidden"> | </span>
            <a href="/blog/category.html#ios" class="hidden">iOS</a>
          </div>
          <div>
            
          <a href="https://www.yuque.com/guoqzuo" target="_black" class="hidden">语雀</a>
        
          <a href="https://github.com/zuoxiaobai" target="_black" class="">Github</a>
        
          </div>
        </header>
        <section class="content">
          <article>
            <h1 id="ios通讯录小列子">iOS通讯录小列子</h1>
            
    <div class="article-top">
      <div class="flex">
        这篇文章发布于 2017/01/22，归类于 <a href="/blog/category.html#ios" class="hidden">iOS</a>
        <!-- ，阅读 11 次，今日 1 次 <div class="top-comment">4 条评论</div> -->
        <div id="readAndComment" class="flex"></div>
      </div> 
      <div class="flex keywords" style="flex-wrap: nowrap;">
        <div style="flex-shrink:0; align-self: flex-start;">标签：</div>
        <div class="flex" style="flex-wrap: wrap;"><span>UITableView的使用</span>，<span>通讯录小例子</span>，<span>UITableView左滑删除功能</span></div>
      </div>
    </div>
    <ins class='adsbygoogle' style='display:block;margin-top:1em;margin-bottom:0' data-ad-format='fluid' data-ad-layout-key='-gw-3+1f-3d+2z' data-ad-client='ca-pub-9527676606416641' data-ad-slot='8870245163'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  
            
<blockquote>
<p>小马哥视频里讲的通讯录小例子登录界面用了动画，用的是storyboard拖线跳转，顺便讲了segue，页面传值及发送通知。这里简单的实现通讯录的基本功能，动画就不做了，主要练习页面的跳转以及tableView相关使用，只是了解基本的使用，可以根据实际情况进行优化。</p>
</blockquote>
<p><img src="../../../images/blog/ios/ios_address_list_1.png" alt="ios_address_list_1.png"></p>
<h2 id="登录界面">登录界面</h2>
<ol>
<li>从storyboard启动，拖拽一个导航控制器，将子控制器设置为默认给的View Controller，对应类ViewController，拖拽用户名密码控件什么的就不说了。</li>
</ol>
<p><img src="../../../images/blog/ios/ios_address_list_2.png" alt="ios_address_list_2.png"></p>
<ol start="2">
<li>界面OK后，来看看逻辑：密码的输入框要有遮挡；两个输入框当输入文本的时右边出现删除按钮；登录按键先不让点击，等两个文本框有问题了才能点；登录时判断用户名或密码是否正确，错误弹一个alert框，正确跳转到TableView界面，也就是通讯录的主界面。</li>
</ol>
<p>首先我们需要将两个输入框和登录按钮拖拽到ViewController，分别对应的变量。从storyboard上拖拽下来的控件都不用再new，再进行上面的一些设置。</p>
<p><img src="../../../images/blog/ios/ios_address_list_3.png" alt="ios_address_list_3.png"></p>
<p>登录判断跳转，这里只是模拟，假设账号和密码都为a才能登录成功否则弹窗登录失败，这里会用到UIAlertController(UIActionSheet+UIAlertView后面通讯录页面的注销时有对比)。成功后跳转到通讯录tableview界面，在创建UITableViewController的子类ContactViewController时，勾选xib，用的时候直接alloc] init]就可以。再push该控制器到导航栈。</p>
<p><img src="../../../images/blog/ios/ios_address_list_4.png" alt="ios_address_list_4.png"></p>
<h2 id="通讯录界面">通讯录界面</h2>
<ol>
<li>前面提到过ContactViewController，这个页面用xib来描述，不做任何拖拽。数据加载以及导航条的标题、左右按钮都用代码来实现。</li>
</ol>
<p><img src="../../../images/blog/ios/ios_address_list_5.png" alt="ios_address_list_5.png"></p>
<ol start="2">
<li>导航条设置，在viewDidLoad里设置导航条内容，设置注销弹窗，注销时导航栈pop一次，返回登录页面，添加联系人的函数addContact后面会介绍。</li>
</ol>
<p><img src="../../../images/blog/ios/ios_address_list_6.png" alt="ios_address_list_6.png"></p>
<p>关于弹窗，参见: <a href="http://www.itnose.net/detail/6235874.html">iOS SDK详解之UIAlertController</a>，iOS8后代替AlertView和ActionSheet</p>
<p><img src="../../../images/blog/ios/ios_address_list_7.png" alt="ios_address_list_7.png"></p>
<p><img src="../../../images/blog/ios/ios_address_list_8.png" alt="ios_address_list_8.png"></p>
<ol start="3">
<li>通讯录数据加载，这里用了一个数据模型，用了kvc</li>
</ol>
<p><img src="../../../images/blog/ios/ios_address_list_9.png" alt="ios_address_list_9.png"></p>
<p><img src="../../../images/blog/ios/ios_address_list_10.png" alt="ios_address_list_10.png"></p>
<p>数据载入，这里数据是存在沙盒的Library/Caches文件夹的data.plist里，以字典数组的形式存放。从文件中读入到数组arr，再将这个数组的元素逐一转化为模型，存入新的数组contactsArr，这些操作都在contactArr的get方法里进行。在tableView的数据源方法使用contactsArr时会执行。</p>
<p><img src="../../../images/blog/ios/ios_address_list_11.png" alt="ios_address_list_11.png"></p>
<ol start="4">
<li>tableView细节处理, 添加左滑删除功能，与点击后跳转到编辑界面。关于tableView的基本操作可参见：<a href="http://www.jianshu.com/p/bf6a60151dde">tableview 添加左滑删除</a>，<a href="http://www.jianshu.com/p/284fd7d8c9e9">iOS -- UITableView基本使用</a></li>
</ol>
<p><img src="../../../images/blog/ios/ios_address_list_12.png" alt="ios_address_list_12.png"></p>
<p>这里还有需要处理的是删除数据之后数据的重新写入文件，及当添加或修改联系人重新回到该界面时的数据刷新，其实可以用通知来实现。这里直接用了两个控制器的生命周期函数来处理。</p>
<p><img src="../../../images/blog/ios/ios_address_list_13.png" alt="ios_address_list_13.png"></p>
<h2 id="添加或修改内容">添加或修改内容</h2>
<ol>
<li>添加联系人和修改联系人都是由xib加载。</li>
</ol>
<pre><code class="language-objectivec">- (void)addContact
{
    AddViewController* addView = [[AddViewController alloc] init];
    [self.navigationController pushViewController:addView animated:YES];
}</code></pre>
<ol start="2">
<li>add添加数据，从文件首次读入数据是在arr的get方法里。</li>
</ol>
<p><img src="../../../images/blog/ios/ios_address_list_14.png" alt="ios_address_list_14.png"></p>
<ol start="3">
<li>修改数据，和上面一样，添加或修改完成后返回上一个界面。其实可以发个通知将添加或修改的数据发送给tableView界面，这里就不用读写文件了。</li>
</ol>
<p><img src="../../../images/blog/ios/ios_address_list_15.png" alt="ios_address_list_15.png"></p>
<h2 id="主要代码">主要代码</h2>
<p>ContactViewController.m</p>
<pre><code class="language-objectivec">#import &quot;ContactViewController.h&quot;
#import &quot;AddViewController.h&quot;
#import &quot;Contact.h&quot;
#import &quot;EditViewController.h&quot;
@interface ContactViewController () &lt;UIActionSheetDelegate&gt;

@property (strong, nonatomic) NSMutableArray* arr;
@property (strong, nonatomic) NSMutableArray* contactsArr;
@end

@implementation ContactViewController

// 页面切换时数据存入文件
- (void)viewWillDisappear:(BOOL)animated
{
   [_arr writeToFile:[NSString stringWithFormat:@&quot;%@/Library/Caches/data.plist&quot;,NSHomeDirectory()]  atomically:YES];
}

// 视图将要出现时，重新载入数据
- (void)viewWillAppear:(BOOL)animated
{
    _arr = [NSMutableArray arrayWithContentsOfFile:[NSString stringWithFormat:@&quot;%@/Library/Caches/data.plist&quot;, NSHomeDirectory()]];
    _contactsArr = [[NSMutableArray alloc] init];
    for (NSDictionary* dict in _arr) {
        id c = [Contact contactWithDict:dict];
        [_contactsArr addObject:c];
    }
    NSLog(@&quot;%@&quot;,self.arr);
    [self.tableView reloadData];
}

- (void)viewDidLoad {
    [super viewDidLoad];
    // 左边按钮，注销
    self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@&quot;注销&quot; style:UIBarButtonItemStyleDone target:self action:@selector(logout)];
    // 右边按钮，添加
    self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@&quot;添加&quot; style:UIBarButtonItemStyleDone target:self action:@selector(addContact)];
    // 标题，为了传值，在.h文件设置了一个NSString属性，跳转到该页面之前就设置了该值。
    self.navigationItem.title = [NSString stringWithFormat:@&quot;%@的联系人&quot;, _user];

}

// 注销按钮 新旧弹窗方式
- (void)logout
{
    // 弹出对话框，确定要退出吗?
    UIAlertController* alert = [UIAlertController alertControllerWithTitle:@&quot;确定要注销吗?&quot; message:nil preferredStyle:UIAlertControllerStyleActionSheet];
    [alert addAction:[UIAlertAction actionWithTitle:@&quot;注销&quot; style:UIAlertActionStyleDestructive handler:^(UIAlertAction* action){
        [self.navigationController popViewControllerAnimated:YES];
    }]];
    [alert addAction:[UIAlertAction actionWithTitle:@&quot;取消&quot; style:UIAlertActionStyleCancel handler:nil]];
    [self presentViewController:alert animated:YES completion:nil];

    //UIAlertView* alertView = [[UIAlertView alloc] initWithTitle:@&quot;确定要注销吗?&quot; message:nil delegate:self cancelButtonTitle:@&quot;取消&quot; otherButtonTitles:nil];

    //    UIActionSheet* alert = [[UIActionSheet alloc] initWithTitle:@&quot;确定要注销吗&quot; delegate:self cancelButtonTitle:@&quot;取消&quot; destructiveButtonTitle:@&quot;注销&quot; otherButtonTitles: nil];
    // 显示弹窗视图
    //    [alert showInView:self.view];
}
// 需遵守协议 &lt;UIActionSheetDelegate&gt;
//- (void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex
//{
//    if (buttonIndex == 0) {
//        [self.navigationController popViewControllerAnimated:YES];
//    }
//}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)addContact
{
    AddViewController* addView = [[AddViewController alloc] init];
    [self.navigationController pushViewController:addView animated:YES];
}

// 数据  NSMutableArray* arr; 字典数组，NSMutableArray* contactsArr; Contact数组
- (NSMutableArray*)contactsArr
{
    if (!_contactsArr) {
        _arr = [NSMutableArray arrayWithContentsOfFile:[NSString stringWithFormat:@&quot;%@/Library/Caches/data.plist&quot;, NSHomeDirectory()]];
        _contactsArr = [[NSMutableArray alloc] init];
        for (NSDictionary* dict in _arr) {
            id c =
             [Contact contactWithDict:dict];
            [_contactsArr addObject:c];
        }
    }
    return _contactsArr;
}

#pragma mark - Tableview data source
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return self.contactsArr.count;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    static NSString* ID = @&quot;cell&quot;;
    UITableViewCell* cell = [tableView dequeueReusableCellWithIdentifier:ID];
    if (!cell) {
        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleValue1                                      reuseIdentifier:ID];
    }
    Contact* con = self.contactsArr[indexPath.row];
    cell.textLabel.text = con.name;
    cell.detailTextLabel.text = con.tel;

    return cell;
}

// 左滑删除 - 添加编辑模式
- (BOOL)tableView:(UITableView *)tableView canEditRowAtIndexPath:(NSIndexPath *)indexPath
{
    return YES;
}

// 左滑删除 - 左滑动时出现的文字
- (NSString*)tableView:(UITableView *)tableView titleForDeleteConfirmationButtonForRowAtIndexPath:(NSIndexPath *)indexPath
{
    return @&quot;删除&quot;;
}

// 左滑删除 - 删除动作
- (void)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath
{
    // 从数据源删除
    [self.arr removeObjectAtIndex:indexPath.row];
    [self.contactsArr removeObjectAtIndex:indexPath.row];
    // 从列表中删除
    [tableView deleteRowsAtIndexPaths:[NSArray arrayWithObject:indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
}

// 选中时进入编辑界面
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(nonnull NSIndexPath *)indexPath {
    EditViewController* add = [[EditViewController alloc] init];
    Contact* con = self.contactsArr[indexPath.row];
    add.name_tmp = con.name;
    add.tel_tmp = con.tel;
    add.index = indexPath.row;
    [self.navigationController pushViewController:add animated:YES];
}

@end
AddViewController.m

#import &quot;AddViewController.h&quot;
#import &quot;Contact.h&quot;
@interface AddViewController ()

@property (weak, nonatomic) IBOutlet UITextField *name;
@property (weak, nonatomic) IBOutlet UITextField *tel;
@property (weak, nonatomic) IBOutlet UIButton *addBtn;
@property (strong, nonatomic) NSMutableArray* arr;

@end

@implementation AddViewController

- (IBAction)add:(id)sender {
    NSMutableDictionary* dict = [NSMutableDictionary dictionaryWithObjectsAndKeys:_name.text,@&quot;name&quot;,_tel.text,@&quot;tel&quot;,nil];
    if (self.arr == nil) {
        self.arr = [[NSMutableArray alloc] init];
    }
    [self.arr addObject:dict];
    NSLog(@&quot;%@&quot;,self.arr);
    [self.arr writeToFile:[NSString stringWithFormat:@&quot;%@/Library/Caches/data.plist&quot;,NSHomeDirectory()] atomically:YES];
    [self.navigationController popViewControllerAnimated:YES];
    NSLog(@&quot;%s&quot;, __func__);
}

- (void)viewDidLoad {
    [super viewDidLoad];

    _addBtn.enabled = NO;
    [_name addTarget:self action:@selector(textChanged) forControlEvents:UIControlEventEditingChanged];
    [_tel addTarget:self action:@selector(textChanged) forControlEvents:UIControlEventEditingChanged];
    _name.clearButtonMode = UITextFieldViewModeWhileEditing;
    _tel.clearButtonMode = UITextFieldViewModeWhileEditing;

    self.navigationItem.title = @&quot;添加联系人&quot;;
    self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@&quot;取消&quot; style:UIBarButtonItemStyleDone target:self action:@selector(back)];

    // Do any additional setup after loading the view from its nib.
}

- (void)textChanged
{
    _addBtn.enabled = ![_name.text isEqualToString:@&quot;&quot;] &amp;&amp; ![_tel.text isEqualToString:@&quot;&quot;];
}

- (void)back
{
    [self.navigationController popViewControllerAnimated:YES];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}


- (NSMutableArray*)arr
{
    if (!_arr) {
        _arr = [NSMutableArray arrayWithContentsOfFile:[NSString stringWithFormat:@&quot;%@/Library/Caches/data.plist&quot;, NSHomeDirectory()]];
    }
    return _arr;
}

@end
EditViewController.m

#import &quot;EditViewController.h&quot;

@interface EditViewController ()

@property (weak, nonatomic) IBOutlet UITextField *name;
@property (weak, nonatomic) IBOutlet UITextField *tel;
@property (weak, nonatomic) IBOutlet UIButton *editBtn;
@property (strong, nonatomic)NSMutableArray* arr;

@end

@implementation EditViewController

// 修改
- (IBAction)edit:(id)sender {
    if ([_name.text isEqualToString:@&quot;&quot;] || [_tel.text isEqualToString:@&quot;&quot;]) {
        // 有空的。
        UIAlertController* alertC = [UIAlertController alertControllerWithTitle:@&quot;联系人或电话不能为空&quot; message:nil preferredStyle:UIAlertControllerStyleAlert];
//        [alertC addAction:[UIAlertAction actionWithTitle:@&quot;取消&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction* action){
//        
//        }]];
        [alertC addAction:[UIAlertAction actionWithTitle:@&quot;确定&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction* action){

        }]];
        [self presentViewController:alertC animated:YES completion:nil];
    } else {  // 修改
        // 拿到原始数据
        _arr = [NSMutableArray arrayWithContentsOfFile:[NSString stringWithFormat:@&quot;%@/Library/Caches/data.plist&quot;, NSHomeDirectory()]];
        NSDictionary* dict = _arr[_index];
        // 修改
        [dict setValue:_name.text forKey:@&quot;name&quot;];
        [dict setValue:_tel.text forKey:@&quot;tel&quot;];
        // 存入文件
        [_arr writeToFile:[NSString stringWithFormat:@&quot;%@/Library/Caches/data.plist&quot;, NSHomeDirectory()] atomically:YES];

        [self.navigationController popViewControllerAnimated:YES];
    }
}

- (void)viewDidLoad {
    [super viewDidLoad];
    _editBtn.hidden = YES;
    _name.text = _name_tmp;
    _tel.text = _tel_tmp;
    _name.clearButtonMode = UITextFieldViewModeWhileEditing;
     _tel.clearButtonMode = UITextFieldViewModeWhileEditing;
    _name.enabled = NO;
    _tel.enabled = NO;
    self.navigationItem.title = @&quot;联系人详情&quot;;
    self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@&quot;编辑&quot; style:UIBarButtonItemStyleDone target:self action:@selector(enableEdit)];
    // Do any additional setup after loading the view from its nib.
}

- (void)enableEdit
{
    _name.enabled = YES;
    _tel.enabled = YES;
    _editBtn.hidden = NO;
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

@end</code></pre>

            
            <ins class='adsbygoogle' style='display:block;text-align:center;' data-ad-layout='in-article' data-ad-format='fluid' data-ad-client='ca-pub-9527676606416641' data-ad-slot='5125924359'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            <!-- 评论系统占位 -->
            <div id="commentDiv"></div>
          </article>

          <aside>
            <div class="aside-wrap">
              <div class="top ">
                <ul><li><span class="ul-span" data-id="ios通讯录小列子" style="padding-left:1em">iOS通讯录小列子<span></li><ul><li><span class="ul-span" data-id="登录界面" style="padding-left:2em">登录界面<span></li></ul><ul><li><span class="ul-span" data-id="通讯录界面" style="padding-left:2em">通讯录界面<span></li></ul><ul><li><span class="ul-span" data-id="添加或修改内容" style="padding-left:2em">添加或修改内容<span></li></ul><ul><li><span class="ul-span" data-id="主要代码" style="padding-left:2em">主要代码<span></li></ul></ul>
              </div>
              <ins class='adsbygoogle' style='display:block;width:300px;height:250px;' data-ad-client='ca-pub-9527676606416641' data-ad-slot='9476232907'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
          </aside>
        </section>
        <footer>
          <div class="footer_content">
            <div class="footer_right">Copyright © 2016-2020 zuo11.com. <a href='http://www.beian.miit.gov.cn/'>鄂ICP备16014741号-1</a></div>
            <div>Powered by <a href='https://github.com/zuoxiaobai/zuo-blog' target='_black'>zuo-blog</a></div>
          </div>
        </footer>
        <script src="/lib/prismjs/prism_default.js"></script>
        <script src="/lib/notes.js"></script> 
        <script src="/lib/global.js"></script>
        <script>
          
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?183281668cc3440449274d1f93c04de6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-178732583-1"></script> -->
<script>
  // window.dataLayer = window.dataLayer || [];
  // function gtag(){dataLayer.push(arguments);}
  // gtag('js', new Date());
  // gtag('config', 'UA-178732583-1');

  window.onload = function() {
    setTimeout(function() {
      let script = document.createElement("script");
      script.setAttribute("data-ad-client", "ca-pub-9527676606416641");
      script.setAttribute("async", "");
      script.src = "//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js";
      document.body.appendChild(script);
    }, 2000);
  }
</script>

      </body>
    </html>
  