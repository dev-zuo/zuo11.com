
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <meta name="application name" content="http_axios_interceptors.html">
        <meta name="author" content="guoqzuo">
        <meta name="description" content="axios提供了请求拦截与响应拦截的函数axios.interceptors，请求拦截器有什么用呢？具体怎么使用？下面来看看">
        <meta name="keywords" content="axios请求拦截,axios响应拦截,axios.interceptors,axios拦截器">

        <title>axios请求拦截与响应拦截 - 左小白的技术日常</title>
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link href="/lib/prismjs/prism_default.css" rel="stylesheet" />
        <link href="/lib/notes.css" rel="stylesheet" />
        <link rel="stylesheet" href="/lib/global.css">
      </head>
      <body>
        <header>
          <div>
            <img src="/images/logo.png" width="24" height="24" class="pointer" onclick="gotoIndex()" />
            <span class="pointer" onclick="gotoIndex()">左小白的技术日常</span>
            <span class="hidden"> | </span>
            <a href="/blog/category.html#http与https" class="hidden">http与https</a>
          </div>
          <div>
            
          <a href="https://www.yuque.com/guoqzuo" target="_black" class="hidden">语雀</a>
        
          <a href="https://space.bilibili.com/486840111" target="_black" class="hidden">B站</a>
        
          <a href="https://github.com/zuoxiaobai" target="_black" class="">Github</a>
        
          </div>
        </header>
        <section class="content">
          <article>
            
    <div class="article-top">
      <div>2019/10/12</div> 
      <div class="article-top-right">Author: guoqzuo</div>
    </div>
  
            <h1 id="axios请求拦截与响应拦截">axios请求拦截与响应拦截</h1>
<p>axios提供了请求拦截与响应拦截的函数axios.interceptors，请求拦截器有什么用呢？具体怎么使用？下面来看看</p>
<h2 id="请求拦截函数">请求拦截函数</h2>
<p>向后台发起实际请求前，会进入axios.interceptors.request，参数config是请求的相关参数。作用如下</p>
<ol>
<li>可以对请求参数作出一些配置。<strong>比如加一些公共参数</strong></li>
<li>在函数里面可以接触发全局的loading提示，一般可以用于移动端</li>
</ol>
<pre><code class="language-js">// axios.interceptors.request.use(resolve func, reject func)
// Add a request interceptor
axios.interceptors.request.use(async function (config) {
  // Do something before request is sent
  console.log(&#39;request 拦截: &#39;, config)

  // 为所有请求加一个时间戳参数
  config.url  += (config.url.includes(&#39;?&#39;) ? &#39;&amp;&#39; : &#39;?&#39;)  + &#39;t=&#39; + (+new Date())
  // Request URL: https://zuo11.com/getList?num=5&amp;start=5&amp;t=1575620590972

  await new Promise((resolve, reject) =&gt; {
    console.log(&#39;开始等待中...&#39;)
    setTimeout(()=&gt; {
      resolve(&#39;结束等待&#39;)
    }, 5000)
  })

  return config; // 用来请求的参数
}, function (error) {
  // Do something with request error
  return Promise.reject(error);
});</code></pre>
<p>config 里的内容，包括url，method，参数等</p>
<pre><code class="language-js">// axios.get(&#39;https://zuo11.com/getList?num=5&amp;start=5&#39;) 请求后config内容
// 打印内容格式如下：
// {
//   &quot;url&quot;: &quot;https://zuo11.com/getList?num=5&amp;start=5&quot;,
//   &quot;data&quot;: undefined
//   &quot;method&quot;: &quot;get&quot;,
//   &quot;headers&quot;: {
//     &quot;common&quot;: {
//       &quot;Accept&quot;: &quot;application/json, text/plain, */*&quot;
//     }
//   },
//   &quot;timeout&quot;: 0,
//   &quot;xsrfCookieName&quot;: &quot;XSRF-TOKEN&quot;,
//   &quot;xsrfHeaderName&quot;: &quot;X-XSRF-TOKEN&quot;,
//   &quot;maxContentLength&quot;: -1
// }</code></pre>
<h2 id="响应拦截函数">响应拦截函数</h2>
<p>后端接收到请求处理后，响应给前端，axios请求 Promise状态变更，进入then后面的逻辑前，会进入响应拦截的逻辑，作用如下</p>
<ol>
<li>对某个特定的错误码处理，比如返回登录过期的code，指定重定向到登录页，而不用每次请求都处理</li>
<li>返回数据过滤，一般返回的data位于 res.data.data 可以将结果过滤为res.data，使用更方便</li>
</ol>
<pre><code class="language-js">// axios.interceptors.response.use(resolve func, reject func)
// Add a response interceptor
axios.interceptors.response.use(function (response) {
  // Any status code that lie within the range of 2xx cause this function to trigger
  // Do something with response data
  console.log(&#39;响应拦截&#39;, response)

  // 如果身份校验失败，返回登录页
  response.data.code === 111  &amp;&amp; (window.location.href = response.data)

  return response.data // 过滤掉除data参数外的其它参数，响应接收到的值。
  // return response;
}, function (error) {
  // Any status codes that falls outside the range of 2xx cause this function to trigger
  // Do something with response error
  return Promise.reject(error);
});</code></pre>
<h2 id="执行顺序问题">执行顺序问题</h2>
<ol>
<li>先执行请求拦截（特意在拦截中加了一个阻塞5s的await）</li>
<li>向后端发送请求</li>
<li>触发响应拦截(这里也可能存在等待时间)</li>
<li>最后才会执行axios请求then后面的内容</li>
</ol>
<h2 id="完整demo">完整demo</h2>
<p>代码以放到github: <a href="https://github.com/zuoxiaobai/fedemo/blob/master/src/DebugDemo/axios%E6%8B%A6%E6%88%AA%E5%99%A8/index.html">axios拦截器demo - github</a></p>
<pre><code class="language-html">&lt;!-- demo --&gt;
&lt;body&gt;
  &lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt;
  &lt;script&gt;
    // Add a request interceptor
    axios.interceptors.request.use(async function (config) {
      // Do something before request is sent
      console.log(&#39;request 拦截: &#39;, config)

      // 为所有请求加一个时间戳参数
      config.url  += (config.url.includes(&#39;?&#39;) ? &#39;&amp;&#39; : &#39;?&#39;)  + &#39;t=&#39; + (+new Date())
      // Request URL: https://zuo11.com/getList?num=5&amp;start=5&amp;t=1575620590972

      await new Promise((resolve, reject) =&gt; {
        console.log(&#39;开始等待中...&#39;)
        setTimeout(()=&gt; {
          resolve(&#39;结束等待&#39;)
        }, 5000)
      })

      return config; // 用来请求的参数
    }, function (error) {
      // Do something with request error
      return Promise.reject(error);
    });

    // Add a response interceptor
    axios.interceptors.response.use(function (response) {
      // Any status code that lie within the range of 2xx cause this function to trigger
      // Do something with response data
      console.log(&#39;响应拦截&#39;, response)

      // 如果身份校验失败，返回登录页
      response.data.code === 111  &amp;&amp; (window.location.href = response.data)

      return response.data // 过滤掉除data参数外的其它参数，响应接收到的值。
      // return response;
    }, function (error) {
      // Any status codes that falls outside the range of 2xx cause this function to trigger
      // Do something with response error
      return Promise.reject(error);
    });

    axios.get(&#39;https://zuo11.com/getList?num=5&amp;start=5&#39;).then((res) =&gt; {
      console.log(&#39;请求成功，&#39;, res)
    }, (err)=&gt; {
      console.log(&#39;请求发生了错误,&#39;, err)
    })
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
<p>参考文档: <a href="https://github.com/axios/axios#interceptors">https://github.com/axios/axios#interceptors</a></p>

          </article>
          <aside>
            <div>
              <ul><li><span class="ul-span" data-id="axios请求拦截与响应拦截" style="padding-left:1em">axios请求拦截与响应拦截<span></li><ul><li><span class="ul-span" data-id="请求拦截函数" style="padding-left:2em">请求拦截函数<span></li></ul><ul><li><span class="ul-span" data-id="响应拦截函数" style="padding-left:2em">响应拦截函数<span></li></ul><ul><li><span class="ul-span" data-id="执行顺序问题" style="padding-left:2em">执行顺序问题<span></li></ul><ul><li><span class="ul-span" data-id="完整demo" style="padding-left:2em">完整demo<span></li></ul></ul>
            <div>
          </aside>
        </section>
        <footer>
          <div class="footer_content">
            <div class="footer_right">Copyright © 2016-2020 zuo11.com. <a href='http://www.beian.miit.gov.cn/'>鄂ICP备16014741号-1</a></div>
            <div>Powered by <a href='https://github.com/zuoxiaobai/zuo-blog' target='_black'>zuo-blog</a></div>
          </div>
        </footer>
        <script src="/lib/prismjs/prism_default.js"></script>
        <script src="/lib/notes.js"></script> 
        <script src="/lib/global.js"></script>
        <script>
          
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?183281668cc3440449274d1f93c04de6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    
        </script>
      </body>
    </html>
  