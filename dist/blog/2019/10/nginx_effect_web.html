
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <meta name="application name" content="nginx_effect_web.html">
        <meta name="author" content="guoqzuo">
        <meta name="description" content="一般前端代码开发好后，会部署到nginx，但nginx的某些默认配置，会使前端页面受到影响，比如默认请求超时限制，默认文件上传大小限制，默认字符编码问题等。下面来看具体的问题，以及怎么解决这些问题。">
        <meta name="keywords" content="nginx默认配置对前端开发的一些影响,ngnix请求超时时间默认60s,nginx默认文件上传大小限制为1M,nginx中文图片路径404的问题">

        <title>nginx默认配置对前端开发的一些影响 - 左小白的技术日常</title>
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link href="/lib/prismjs/prism_default.css" rel="stylesheet" />
        <link href="/lib/notes.css" rel="stylesheet" />
        
      </head>
      <body>
        <header>
          <div>
            <img src="/images/logo.png" width="24" height="24" class="pointer" onclick="gotoIndex()" />
            <span class="pointer" onclick="gotoIndex()">左小白的技术日常</span>
            <span class="hidden"> | </span>
            <a href="/blog/category.html#运维部署" class="hidden">运维部署</a>
          </div>
          <div>
            
          <a href="https://www.yuque.com/guoqzuo" target="_black" class="hidden">语雀</a>
        
          <a href="https://github.com/zuoxiaobai" target="_black" class="">Github</a>
        
          </div>
        </header>
        <section class="content">
          <article>
            
    <div class="article-top">
      <div>2019/10/28</div> 
      <div class="article-top-right">Author: guoqzuo</div>
    </div>
  
            <h1 id="nginx默认配置对前端开发的一些影响">nginx默认配置对前端开发的一些影响</h1>
<p>一般前端代码开发好后，会部署到nginx，但nginx的某些默认配置，会使前端页面受到影响，比如默认请求超时限制，默认文件上传大小限制，默认字符编码问题等。下面来看具体的问题，以及怎么解决这些问题。</p>
<h2 id="nginx请求超时时间默认60s">nginx请求超时时间默认60s</h2>
<p>axios请求时，配置config里有一个是设置请求超时时间的，有一次接口响应巨慢，超过了1分钟，于是我在axios里设置了超时时间为2分钟，但没效果。后来发现是nginx的默认配置限制了。</p>
<pre><code class="language-js">// `timeout` specifies the number of milliseconds before the request times out.
// If the request takes longer than `timeout`, the request will be aborted.
timeout: 1000, // default is `0` (no timeout)</code></pre>
<p>综上：前端就算超时设置为2分钟，但如果前端代码部署到了nginx上，也会导致1分钟超时，你也可以修改nginx的默认配置项</p>
<pre><code class="language-conf">location / {
  root d:/test/;
  fastcgi_connect_timeout 600; # set timeout
  fastcgi_send_timeout 600; 
  fastcgi_read_timeout 600;
}</code></pre>
<h2 id="nginx默认文件上传大小限制为1m">nginx默认文件上传大小限制为1M</h2>
<p>在做图片上传功能时，和后台本地联调都挺好的。但部署到服务器后，发现图片上传有时候会失败，后来用charles抓包发现，当图片大于1M时，就会超时。最开始以为是后端的问题，找后端调试时，返现后端根本没有收到上传的请求，然后我就想到可能是nginx这里直接拦截了请求，查资料后发现果然是这样。</p>
<p>所以，对于有文件 &gt; 1M 需要上传的，需要修改下 nginx默认配置</p>
<pre><code class="language-conf">server {
  listen       80;
  server_name  localhost;
  client_max_body_size 10M; #增加这个参数就可以指定最大上传文件大小为10m了；
}</code></pre>
<h2 id="nginx字符编码与系统字符编码不一致导致中文图片路径404的问题">nginx字符编码与系统字符编码不一致导致中文图片路径404的问题</h2>
<p>上一次更新博客时，在mac本地调试时，都是ok的，部署到windows服务器上后时，发现一个图片出现了404的问题，最开始以为是缓存的问题，清了缓存后还是404。这张图片是中文路径，之前全部用的是英文的，没发现这个问题。试了下英文的图片链接是ok的。百度了下，发现确实有这种问题。是nginx设置的编码与操作系统的编码不一致的问题。</p>
<pre><code class="language-bash"># linux查看电脑默认编码
echo  $LANG
# zh_CN.UTF-8

# windows下查看默认字符编码
chcp
# 如果显示 活动代码页 936 表示GBK编码  我的服务器就是这个编码，修改了nginx charset utf-8;没效果
# 65001 表示utf-8

# 设置字符编码，但发现只在当前控制台生效，重新开一个就没了。
chcp 65001

# 有个修改注册表的方法：不知道是否可行，但怕影响服务器的其它服务，还是算了，改英文名比较稳。。。。
# https://blog.csdn.net/yangzhong0808/article/details/79012628?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</code></pre>

          </article>
          <aside>
            <div>
              <ul><li><span class="ul-span" data-id="nginx默认配置对前端开发的一些影响" style="padding-left:1em">nginx默认配置对前端开发的一些影响<span></li><ul><li><span class="ul-span" data-id="nginx请求超时时间默认60s" style="padding-left:2em">nginx请求超时时间默认60s<span></li></ul><ul><li><span class="ul-span" data-id="nginx默认文件上传大小限制为1m" style="padding-left:2em">nginx默认文件上传大小限制为1M<span></li></ul><ul><li><span class="ul-span" data-id="nginx字符编码与系统字符编码不一致导致中文图片路径404的问题" style="padding-left:2em">nginx字符编码与系统字符编码不一致导致中文图片路径404的问题<span></li></ul></ul>
            <div>
          </aside>
        </section>
        <footer>
          <div class="footer_content">
            <div class="footer_right">Copyright © 2016-2020 zuo11.com. <a href='http://www.beian.miit.gov.cn/'>鄂ICP备16014741号-1</a></div>
            <div>Powered by <a href='https://github.com/zuoxiaobai/zuo-blog' target='_black'>zuo-blog</a></div>
          </div>
        </footer>
        <script src="/lib/prismjs/prism_default.js"></script>
        <script src="/lib/notes.js"></script> 
        <script src="/lib/global.js"></script>
        <script>
          
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?183281668cc3440449274d1f93c04de6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    
        </script>
      </body>
    </html>
  