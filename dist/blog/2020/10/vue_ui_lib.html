
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <meta name="application name" content="vue_ui_lib.html">
        <meta name="author" content="guoqzuo">
        <meta name="description" content="下面通过一个简单的示例来看怎么写一个vue组件库，分为 6 步：1. 目录规划 2. 组件库入口文件 3. 本地测试组件 4. 打包构建 UMD 5. 上传 npm 包 6. dosify搭建官网">
        <meta name="keywords" content="vue组件库,vue组件库编写流程">

        <title>怎么用vue写一个组件库，类似element - 左小白的技术日常</title>
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link href="/lib/prismjs/prism_default.css" rel="stylesheet" />
        <link href="/lib/notes.css" rel="stylesheet" />
        <link rel="stylesheet" href="/lib/global.css">
        
      </head>
      <body>
        <header>
          <div>
            <img src="/images/logo.png" width="24" height="24" class="pointer" onclick="gotoIndex()" />
            <span class="pointer" onclick="gotoIndex()">左小白的技术日常</span>
            <span class="hidden"> | </span>
            <a href="/blog/category.html#vue" class="hidden">Vue</a>
          </div>
          <div>
            
          <a href="http://fe.zuo11.com" target="_black" class="hidden">我的笔记</a>
        
          <a href="https://github.com/zuoxiaobai" target="_black" class="">Github</a>
        
          </div>
        </header>
        <section class="content">
          <article>
            <h1 id="怎么用vue写一个组件库，类似element">怎么用vue写一个组件库，类似element</h1>
            
    <div class="article-top">
      <div class="flex">
        这篇文章发布于 2020/10/25，归类于 <a href="/blog/category.html#vue" class="hidden">Vue</a>
        <!-- ，阅读 11 次，今日 1 次 <div class="top-comment">4 条评论</div> -->
        <div id="readAndComment" class="flex"></div>
      </div> 
      <div class="flex keywords" style="flex-wrap: nowrap;">
        <div style="flex-shrink:0; align-self: flex-start;">标签：</div>
        <div class="flex" style="flex-wrap: wrap;"><span>vue组件库</span>，<span>vue组件库编写流程</span></div>
      </div>
    </div>
    
  
            
<p>下面通过一个简单的示例来看怎么写一个vue组件库，分为 6 步</p>
<ol>
<li>目录规划</li>
<li>组件库入口文件</li>
<li>本地测试组件</li>
<li>打包构建 UMD</li>
<li>上传 npm 包</li>
<li>dosify搭建官网</li>
</ol>
<h2 id="1组件库目录结构">1.组件库目录结构</h2>
<p>以 element 为例，下面是一个简单的目录结构</p>
<pre><code class="language-bash">├── examples # 用于测试组件，demo展示（可以直接是一个完整的vue项目）
├── packages # 用于存放编写的组件
│   └── my-button # 封装的组件，具体写法参见element源码
│       ├── src    
│       │   └── main.vue  # 单文件组件，组件
│       └── index.js  # install方法，用于Vue.use()引入单个组件
└── src
    └── index.js # 入口文件</code></pre>
<h2 id="2导出组件库">2.导出组件库</h2>
<p>我们写好组件后，主要问题是要怎么导出(export)供其他项目使用，一般在 src/index.js 里进行处理</p>
<pre><code class="language-js">// src/index.js 示例，主要是引入(import)组件再导出(export)，包括Vue.use所需的 install函数处理
import MyButton from &quot;../packages/my-button/index.js&quot;;
const components = [MyButton];

// Vue.use() 一次性安装所有组件
const install = function(Vue) {
  if (install.installed) return;
  components.forEach(component =&gt; Vue.use(component));
  // 如果没有在src/index.js里实现install方法，就需要使用下面的
  // components.forEach(component =&gt; Vue.component(component.name, component))
};

// 直接给浏览器或 AMD loader 使用
if (typeof window !== undefined &amp;&amp; window.Vue) {
  window.Vue.use(install);
  if (install.installed) {
    install.installed = false;
  }
}

export default {
  install, // 用于ES modules，import Vue 后直接使用 Vue.use()
  MyButton // 支持解构赋值按需引入单个组件
};</code></pre>
<h2 id="3本地测试组件">3.本地测试组件</h2>
<p>假设我们这个组件命名为vue-chart，那可以在 examples/src/mian.js 直接使用</p>
<pre><code class="language-js">// examples/src/mian.js
// 引入所有组件
import VueChart from &#39;../../src/index.js&#39;
Vue.use(VueChart)

// 按需引入单个组件
import { MyButton } from &#39;../../src/index.js&#39;
Vue.use(MyButton)</code></pre>
<p>引入后，我们在 App.vue里直接使用该组件</p>
<pre><code class="language-html">&lt;!-- App.vue --&gt;
&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;
    &lt;my-button id=&quot;btn&quot;&gt;测试按钮&lt;/my-button&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<p>这里可能涉及到 examples 目录 npm run serve 时，提示 eslint 错误</p>
<p><img src="../../../images/blog/vue/eslint-error.png" alt="eslint-error.png"></p>
<p>因为 examples 是一个独立的vue项目，引入了外部 packages 目录的文件，如果 packages 下组件不符合eslint规则就需要在项目根目录的package.json里配置eslint规则了，与examples项目的eslint规则保持一致。参考我之前的笔记：&quot;怎么在老项目中加入eslint规则，并可以保存后自动fix&quot;</p>
<p>这样使用eslint处理 packages 目录下的代码，再运行 examples 目录下的 npm run serve 就可以正常加载组件了</p>
<h2 id="4打包构建umd">4.打包构建umd</h2>
<p>上面我们本地测试了，但他不能直接在普通网页中通过引入某个js文件来使用，这就需要使用Vue CLI来打包构建了</p>
<p>使用 vue-cli 打包成 lib，参考文档 <a href="https://cli.vuejs.org/zh/guide/build-targets.html#%E5%BA%94%E7%94%A8">构建目标 | Vue CLI</a></p>
<p>由于我们的项目结构不是通过vue-cli生成的，所以就算使用<code>npm install @vue/cli --save</code>，安装 @vue/cli，也无法使用 vue-cli-service 服务，因为 @vue/cli 这个包是一个用于生成脚手架项目的。你没有用它生成项目，如果不安装对应的 npm 包是无法使用 vue-cli-servie 的，我们直接从 vue create 生成的项目中把 devDependencies、dependencies，配置移动到根目录的 package.json 里，再npm install</p>
<pre><code class="language-js">// dependencies
&quot;dependencies&quot;: {
  &quot;core-js&quot;: &quot;^3.6.5&quot;,
  &quot;vue&quot;: &quot;^2.6.11&quot;
},
// devDependencies
&quot;@vue/cli-plugin-babel&quot;: &quot;~4.5.0&quot;,
&quot;@vue/cli-plugin-router&quot;: &quot;~4.5.0&quot;,
&quot;@vue/cli-plugin-vuex&quot;: &quot;~4.5.0&quot;,
&quot;@vue/cli-service&quot;: &quot;~4.5.0&quot;,
&quot;less&quot;: &quot;^3.0.4&quot;,
&quot;less-loader&quot;: &quot;^5.0.0&quot;,
&quot;vue-template-compiler&quot;: &quot;^2.6.11&quot;
// browserslist
&quot;browserslist&quot;: [
  &quot;&gt; 1%&quot;,
  &quot;last 2 versions&quot;,
  &quot;not dead&quot;
],</code></pre>
<p>新增一个lib打包命令</p>
<pre><code class="language-js">// --dest  lib 指定 output 目录文 lib，默认为 dist 目录
// src/index.js 最后为入口文件，默认为 src/App.vue。
&quot;scripts&quot;: {
  &quot;build:lib&quot;: &quot;vue-cli-service build --mode lib --target lib --dest lib src/index.js&quot;
}   </code></pre>
<p>理论上 npm run build:lib 会在当前目录下创建lib目录，且包含4个文件</p>
<ul>
<li>lib/myLib.common.js：一个给打包器用的 CommonJS 包 (不幸的是，webpack 目前还并没有支持 ES modules 输出格式的包)</li>
<li>lib/myLib.umd.js：一个直接给浏览器或 AMD loader 使用的 UMD 包</li>
<li>lib/myLib.umd.min.js：压缩后的 UMD 构建版本</li>
<li>lib/myLib.css：提取出来的 CSS 文件 (可以通过在 vue.config.js 中设置 css: { extract: false } 强制内联)</li>
</ul>
<p>实际我这里打包后没有生成css文件，因为我们多加了一个 --mode lib 参数</p>
<p><img src="../../../images/blog/vue/vue_chart_build_lib.png" alt="vue_chart_build_lib.png"></p>
<p>一般将打包后的文件 xx.umd.js 引入到项目中就可以使用了，来看看示例</p>
<pre><code class="language-html">&lt;!-- docs/index.html --&gt;
&lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;
        &lt;my-button&gt;我的按钮&lt;/my-button&gt;
    &lt;/div&gt;
    &lt;script src=&quot;https://unpkg.com/vue&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;../lib/vue-chart.umd.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        const app = new Vue({
            el: &#39;#app&#39;
        })
    &lt;/script&gt;
&lt;/body&gt;</code></pre>
<p><img src="../../../images/blog/vue/vue_chat_test1.png" alt="vue_chat_test1.png"></p>
<p>vue项目中引用</p>
<pre><code class="language-js">// examples/src/main.js
import VueChart from &quot;../../lib/vue-chart.umd.js&quot;;
Vue.use(VueChart);</code></pre>
<p>效果如下</p>
<p><img src="../../../images/blog/vue/vue_chat_test2.png" alt="vue_chat_test2.png"></p>
<h2 id="5上传npm包">5.上传npm包</h2>
<p>我们可以把包弄成npm包，在其他vue项目中，可以直接引入，将 package.json 的 main.js 设置为umd模块地址，并加上unpkg参数，用于cdn直接引入</p>
<pre><code class="language-js">// package.json
&quot;name&quot;: &quot;@guoqzuo/vue-chart&quot;, // 将项目名称改为加上自己作用域的包
&quot;version&quot;: &quot;0.0.2&quot;, // 设置项目版本，注意每次修改版本，package-lock.json的版本也要改
// 指定npm包入口，当我们import某个npm包时，导入的文件就是这个main指定的文件
&quot;main&quot;: &quot;lib/vue-chart.umd.min.js&quot;
// cdn相关
&quot;unpkg&quot;: &quot;lib/vue-chart.umd.min.js&quot;,</code></pre>
<p>关于unpkg</p>
<p><img src="../../../images/blog/vue/unpkg_info.png" alt="unpkg_info.png"></p>
<p>修改好后，我们来发布这个npm包，注意：需要先有对应的npm账号，我的npm账号是 guoqzuo，这里在项目根目录新建一个publish.sh脚本来发布</p>
<pre><code class="language-sh">#!/usr/bin/env bash
npm config get registry # 检查仓库镜像库
npm config set registry=http://registry.npmjs.org
echo &#39;请进行登录相关操作：&#39;
npm login # 登陆
# npm login --scope=@guoqzuo # 设置登录作用域
echo &quot;-------publishing-------&quot;
npm publish --access public # 发布
npm config set registry=https://registry.npm.taobao.org # 设置为淘宝镜像
echo &quot;发布完成&quot;
exit</code></pre>
<p>一般新建的publish.sh是没有执行权限的，使用 <code>chmod +x publish.sh</code> 添加可执行权限，再 <code>./publish.sh</code> 执行发布，发布过程中，需要登录npm账号、密码等即可</p>
<p><img src="../../../images/blog/vue/vue_chart_npm_push.png" alt="vue_chart_npm_push.png"></p>
<p>我们这里examples目录也跟着发布上传了，可以加参数来限定上传到npm包的文件。细节方面后面在优化。我们可以看到npm官网有我们刚上传的 <a href="https://www.npmjs.com/package/@guoqzuo/vue-chart">@guoqzuo/vue-chart</a> 了</p>
<p><img src="../../../images/blog/vue/guoqzuo_vue_chart.png" alt="guoqzuo_vue_chart.png"></p>
<p>测试npm包，在vue项目中先安装</p>
<pre><code class="language-bash"># 这里建议加@latest，因为有时候发布后有延时
# 直接npm i @guoqzuo/vue-chart 后可能还是原来的旧版本
npm i @guoqzuo/vue-chart@latest</code></pre>
<p>安装完成后，再在 main.js 里引入，npm run serve 后可正常渲染</p>
<pre><code class="language-js">// examples/src/main.js
import VueChart from &quot;@guoqzuo/vue-chart&quot;;
Vue.use(VueChart);</code></pre>
<p>另外，我们再测试下 unpkg cdn是否生效</p>
<pre><code class="language-html">&lt;!-- docs/index.html --&gt;
&lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;
        &lt;my-button&gt;我的按钮&lt;/my-button&gt;
    &lt;/div&gt;
    &lt;script src=&quot;https://unpkg.com/vue&quot;&gt;&lt;/script&gt;
    &lt;!-- &lt;script src=&quot;../lib/vue-chart.umd.js&quot;&gt;&lt;/script&gt; --&gt;
     &lt;script src=&quot;https://unpkg.com/@guoqzuo/vue-chart@latest/lib/vue-chart.umd.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        const app = new Vue({
            el: &#39;#app&#39;
        })
    &lt;/script&gt;
&lt;/body&gt;</code></pre>
<p>测试可正常运行，以上完成了一个基本vue组件库的开发流程，后面再慢慢优化。</p>
<h2 id="6-dosify官网搭建">6. dosify官网搭建</h2>
<p>使用 dosify 写一个组件库官网，参考 <a href="http://www.zuo11.com/blog/2020/10/ui_doc.html">怎么写出类似element官网那样可以实时看运行效果的文档</a></p>
<p>完整代码已上传github，参见 <a href="https://github.com/zuoxiaobai/vue-chart">zuoxiaobai/vue-chart</a></p>
<p>使用 dosify 写的对应的官网 <a href="https://vuechart.zuo11.com">@guoqzuo/vue-chart官网</a></p>
<p>参考：</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000014924557">如何用vue写一个组件库</a></li>
<li><a href="http://www.fly63.com/article/detial/2631">写一个vue组件库_跟着element学习写组件</a></li>
<li><a href="https://vue-loader.vuejs.org/zh/#vue-loader">Vue Loader</a></li>
<li><a href="https://segmentfault.com/a/1190000016365409">package.json 非官方字段集合 - 前端小站 - SegmentFault 思否</a></li>
</ul>

            
            <ins class='adsbygoogle' style='display:block;margin-top:1em;margin-bottom:0' data-ad-format='fluid' data-ad-layout-key='-gw-3+1f-3d+2z' data-ad-client='ca-pub-9527676606416641' data-ad-slot='8870245163'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            <!-- 评论系统占位 -->
            <div id="commentDiv"></div>
          </article>

          <aside>
            <div class="aside-wrap">
              <div class="top ">
                <ul><li><span class="ul-span" data-id="怎么用vue写一个组件库，类似element" style="padding-left:1em">怎么用vue写一个组件库，类似element<span></li><ul><li><span class="ul-span" data-id="1组件库目录结构" style="padding-left:2em">1.组件库目录结构<span></li></ul><ul><li><span class="ul-span" data-id="2导出组件库" style="padding-left:2em">2.导出组件库<span></li></ul><ul><li><span class="ul-span" data-id="3本地测试组件" style="padding-left:2em">3.本地测试组件<span></li></ul><ul><li><span class="ul-span" data-id="4打包构建umd" style="padding-left:2em">4.打包构建umd<span></li></ul><ul><li><span class="ul-span" data-id="5上传npm包" style="padding-left:2em">5.上传npm包<span></li></ul><ul><li><span class="ul-span" data-id="6-dosify官网搭建" style="padding-left:2em">6. dosify官网搭建<span></li></ul></ul>
              </div>
              <ins class='adsbygoogle' style='display:block;width:300px;height:250px;' data-ad-client='ca-pub-9527676606416641' data-ad-slot='9476232907'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
          </aside>
        </section>
        <footer>
          <div class="footer_content">
            <div class="footer_right">Copyright © 2016-2020 zuo11.com. <a href='http://beian.miit.gov.cn/'>鄂ICP备16014741号-1</a></div>
            <div>Powered by <a href='https://github.com/zuoxiaobai/zuo-blog' target='_black'>zuo-blog</a></div>
          </div>
        </footer>
        <script src="/lib/prismjs/prism_default.js"></script>
        <script src="/lib/notes.js"></script> 
        <script src="/lib/global.js"></script>
        <script>
          
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?183281668cc3440449274d1f93c04de6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-178732583-1"></script> -->
<script>
  // window.dataLayer = window.dataLayer || [];
  // function gtag(){dataLayer.push(arguments);}
  // gtag('js', new Date());
  // gtag('config', 'UA-178732583-1');

  window.onload = function() {
    setTimeout(function() {
      let script = document.createElement("script");
      script.setAttribute("data-ad-client", "ca-pub-9527676606416641");
      script.setAttribute("async", "");
      script.src = "//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js";
      document.body.appendChild(script);
    }, 200);
  }
</script>

      </body>
    </html>
  