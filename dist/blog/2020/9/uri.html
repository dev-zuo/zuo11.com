
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <meta name="application name" content="uri.html">
        <meta name="author" content="guoqzuo">
        <meta name="description" content="在JS高程3里介绍URI编码方法时，有这样一个描述：**有效的URI中不能包含某些字符，比如空格。使用URI编码方法可以把所有无效的字符替换为特殊的utf-8编码，从而让浏览器能够接受和理解** 为什么有效的URI不能包含空格等其他字符？ 在《HTTP权威指南》第2章URL与资源 - 各种令人头疼的字符(p38)里有介绍原因：">
        <meta name="keywords" content="URI编码方法详解">

        <title>为什么有效的URI不能包含空格等其他字符，URI编码方法详解 - 左小白的技术日常</title>
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link href="/lib/prismjs/prism_default.css" rel="stylesheet" />
        <link href="/lib/notes.css" rel="stylesheet" />
        <link rel="stylesheet" href="/lib/global.css">
        <script data-ad-client="ca-pub-9527676606416641" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      </head>
      <body>
        <header>
          <div>
            <img src="/images/logo.png" width="24" height="24" class="pointer" onclick="gotoIndex()" />
            <span class="pointer" onclick="gotoIndex()">左小白的技术日常</span>
            <span class="hidden"> | </span>
            <a href="/blog/category.html#http与https" class="hidden">http与https</a>
          </div>
          <div>
            
          <a href="https://www.yuque.com/guoqzuo" target="_black" class="hidden">语雀</a>
        
          <a href="https://github.com/zuoxiaobai" target="_black" class="">Github</a>
        
          </div>
        </header>
        <section class="content">
          <article>
            <h1 id="为什么有效的uri不能包含空格等其他字符，uri编码方法详解">为什么有效的URI不能包含空格等其他字符，URI编码方法详解</h1>
            
    <div class="article-top">
      <div class="flex">
        这篇文章发布于 2020/09/12，归类于 <a href="/blog/category.html#http与https" class="hidden">http与https</a>
        <!-- ，阅读 11 次，今日 1 次 <div class="top-comment">4 条评论</div> -->
        <div id="readAndComment" class="flex"></div>
      </div> 
      <div class="flex keywords" style="flex-wrap: nowrap;">
        <div style="flex-shrink:0; align-self: flex-start;">标签：</div>
        <div class="flex" style="flex-wrap: wrap;"><span>URI编码方法详解</span></div>
      </div>
    </div>
    <ins class='adsbygoogle' style='display:block;margin-top:1em;margin-bottom:0' data-ad-format='fluid' data-ad-layout-key='-gw-3+1f-3d+2z' data-ad-client='ca-pub-9527676606416641' data-ad-slot='8870245163'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  
            
<p>在JS高程3里介绍URI编码方法时，有这样一个描述：<strong>有效的URI中不能包含某些字符，比如空格。使用URI编码方法可以把所有无效的字符替换为特殊的utf-8编码，从而让浏览器能够接受和理解</strong></p>
<h2 id="为什么有效的uri不能包含空格等其他字符？">为什么有效的URI不能包含空格等其他字符？</h2>
<p>在《HTTP权威指南》第2章URL与资源 - 各种令人头疼的字符(p38)里有介绍原因：</p>
<p>URL是可移植的(portable)，它要统一的命名网上所有的资源，意味着要通过各种不同的协议来传送这些资源，这些协议在传输数据时都会使用不同的机制，在设计URL时，需要满足以下特性：</p>
<ol>
<li>可以通过任意协议进行<strong>安全的传输</strong>：完整/不丢失信息，以SMTP电子邮件的简单邮件传输协议为例，它使用的传输方法会剥去一些特定字符，为了避开这些问题，URL只能使用一些相对较小的、通用的安全字母表中的字符。</li>
<li><strong>URL具有可读性</strong>：即使是看不见，不可打印的字符也能在URL中使用，比如空格</li>
<li><strong>完整性</strong>：人们可能会希望URL中可以包含除通用安全字母表之外的二进制数据或字符，因此需要一种转义机制，能够将不安全的字符编码转为安全字符再进行传输</li>
</ol>
<h2 id="js中两种uri编码方法的区别">js中两种URI编码方法的区别</h2>
<p>之前有简单说明encodeURIComponent与encodeURI的区别：<del>encodeURI只转义空格，encodeURIComponent会转义所有的非字母数字字符</del></p>
<p>其实上面的说法是错误的，在mdn的一个示例中，有更加详细说明两者的区别</p>
<pre><code class="language-js">// encodeURI vs encodeURIComponent
// encodeURI() differs from encodeURIComponent() as follows:
var set1 = &quot;;,/?:@&amp;=+$#&quot;; // Reserved Characters
var set2 = &quot;-_.!~*&#39;()&quot;;   // Unreserved Marks
var set3 = &quot;ABC abc 123&quot;; // Alphanumeric Characters + Space  [ˌælfənjuːˈmerɪk] 字母数字 + 空格

console.log(encodeURI(set1)); // ;,/?:@&amp;=+$#
console.log(encodeURI(set2)); // -_.!~*&#39;()
console.log(encodeURI(set3)); // ABC%20abc%20123 (the space gets encoded as %20)

console.log(encodeURIComponent(set1)); // %3B%2C%2F%3F%3A%40%26%3D%2B%24%23
console.log(encodeURIComponent(set2)); // -_.!~*&#39;()
console.log(encodeURIComponent(set3)); // ABC%20abc%20123 (the space gets encoded as %20)</code></pre>
<p>上面的例子中可以看到，URI编码方法一般有3种类型的字符</p>
<table>
<thead>
<tr>
<th>字符类型(中)</th>
<th>字符类型(英)</th>
<th>包含</th>
<th>encodeURI</th>
<th>encodeURIComponent</th>
</tr>
</thead>
<tbody><tr>
<td>URI保留字符</td>
<td>Reserved Characters</td>
<td>&quot;;,/?:@&amp;=+$#&quot;</td>
<td>不转义</td>
<td>转义(escaped)</td>
</tr>
<tr>
<td>非转义字符</td>
<td>Unreserved Marks or Alphanumeric Characters</td>
<td>&quot;-_.!~*&#39;()&quot;以及数字(0-9)、字母(a-zA-Z)</td>
<td>不转义</td>
<td>不转义</td>
</tr>
<tr>
<td>空格等其他字符/中文等</td>
<td>space or other character etc</td>
<td>&quot; 中文？&quot;等其他字符</td>
<td>转义</td>
<td>转义</td>
</tr>
</tbody></table>
<p>通过上面的表格我们可以看到</p>
<ul>
<li><strong>encodeURI不会编码URI保留字符/非转义字符，只会对空格等其他字符(如中文字符，中文等)进行编码</strong></li>
<li><strong>encodeURIComponent不会编码非转义字符，URI保留字符和其他字符都会编码</strong></li>
</ul>
<p>综上，encodeURI与encodeURIComponent的区别是：<strong>encodeURIComponent会对URI保留字符进行编码，而encodeURI则不会，其他逻辑基本一致</strong>。</p>
<h2 id="标准">标准</h2>
<p>下面来看看ECMA262标准/规范(specification)对encodeURI()的定义(definition)</p>
<pre><code class="language-js">18.2.6.4 encodeURI ( uri )
The encodeURI function computes a new version of a UTF-16 encoded (6.1.4) URI in which each instance of certain code points is replaced by one, two, three, or four escape sequences representing the UTF-8 encoding of the code points.

The encodeURI function is the %encodeURI% intrinsic object. When the encodeURI function is called with one argument uri, the following steps are taken:

  1. Let uriString be ? ToString(uri).
  2. Let unescapedURISet be a String containing one instance of each code unit valid in uriReserved and uriUnescaped  
     plus &quot;#&quot;.
  3. Return ? Encode(uriString, unescapedURISet).

NOTE
The code point # is not encoded to an escape sequence even though it is not a reserved or unescaped URI code point.</code></pre>
<p>Runtime Semantics: Encode(string, unescapedSet)</p>
<pre><code class="language-js">The abstract operation Encode takes arguments string (a String) and unescapedSet (a String). It performs URI encoding and escaping. It performs the following steps when called:

1. Let strLen be the number of code units in string.
2. Let R be the empty String.
3. Let k be 0.
4. Repeat,
     a. If k equals strLen, return R.
     b. Let C be the code unit at index k within string.
     c. If C is in unescapedSet, then
          i. Set k to k + 1.
          ii. Set R to the string-concatenation of the previous value of R and C.
     d. Else,
          i. Let cp be ! CodePointAt(string, k).
          ii. If cp.[[IsUnpairedSurrogate]] is true, throw a URIError exception.
          iii. Set k to k + cp.[[CodeUnitCount]].
          iv. Let Octets be the List of octets resulting by applying the UTF-8 transformation to cp.[[CodePoint]].
          v. For each element octet of Octets in List order, do
               1. Set R to the string-concatenation of:
                   - the previous value of R
                   - &quot;%&quot;
                   - the String representation of octet, formatted as a two-digit uppercase hexadecimal number, padded to the left with a zero if necessary</code></pre>
<p>以上，在总结某个知识点的过程中，我们可以发现介绍js相关知识点的平台很多，我们可以大致的判断出文档的详细程度如下：</p>
<p>菜鸟教程/w3school等 &lt;= JS高程3等技术类书籍 &lt;= MDN &lt;= tc39 ECMA标准文档</p>
<p>js相关知识基本都是对API、tc39 ECMA标准文档的总结、梳理。区别在于：</p>
<ol>
<li>整理的意图：是仅仅展示API调用，还是介绍原理（简单说明/详细介绍）</li>
<li>示例demo是否丰富？demo是否可以让人很好的理解知识点？</li>
</ol>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://tc39.es/ecma262/#sec-uri-handling-functions">URI Handling Functions | ECMA-262 Specifications</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI">encodeURI() | MDN</a></li>
<li><a href="http://www.zuo11.com/blog/2020/6/content-dispositon.html">encodeURIComponent与encodeURI的区别</a></li>
<li><a href="https://www.yuque.com/guoqzuo/js_es6/ep07nf#841dc4e5">js高程3的引用类型 - 单体内置对象 - global对象 - URI编码方法笔记</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2010/02/url_encoding.html">关于URL编码 | 阮一峰的网络日志</a></li>
</ul>

            
            <ins class='adsbygoogle' style='display:block;text-align:center;' data-ad-layout='in-article' data-ad-format='fluid' data-ad-client='ca-pub-9527676606416641' data-ad-slot='5125924359'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            <!-- 评论系统占位 -->
            <div id="commentDiv"></div>
          </article>

          <aside>
            <div class="aside-wrap">
              <ins class='adsbygoogle' style='display:inline-block;width:300px;height:250px;' data-ad-client='ca-pub-9527676606416641' data-ad-slot='9476232907'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
              <div class="top ">
                <ul><li><span class="ul-span" data-id="为什么有效的uri不能包含空格等其他字符，uri编码方法详解" style="padding-left:1em">为什么有效的URI不能包含空格等其他字符，URI编码方法详解<span></li><ul><li><span class="ul-span" data-id="为什么有效的uri不能包含空格等其他字符？" style="padding-left:2em">为什么有效的URI不能包含空格等其他字符？<span></li></ul><ul><li><span class="ul-span" data-id="js中两种uri编码方法的区别" style="padding-left:2em">js中两种URI编码方法的区别<span></li></ul><ul><li><span class="ul-span" data-id="标准" style="padding-left:2em">标准<span></li></ul><ul><li><span class="ul-span" data-id="参考" style="padding-left:2em">参考<span></li></ul></ul>
              <div>
            </div>
          </aside>
        </section>
        <footer>
          <div class="footer_content">
            <div class="footer_right">Copyright © 2016-2020 zuo11.com. <a href='http://www.beian.miit.gov.cn/'>鄂ICP备16014741号-1</a></div>
            <div>Powered by <a href='https://github.com/zuoxiaobai/zuo-blog' target='_black'>zuo-blog</a></div>
          </div>
        </footer>
        <script src="/lib/prismjs/prism_default.js"></script>
        <script src="/lib/notes.js"></script> 
        <script src="/lib/global.js"></script>
        <script>
          
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?183281668cc3440449274d1f93c04de6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-178732583-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-178732583-1');
</script>

      </body>
    </html>
  