
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <meta name="application name" content="performance-timing.html">
        <meta name="author" content="guoqzuo">
        <meta name="description" content="performance.timing 记录了在浏览器中输入 url 到页面显示整个过程中各个关键节点的时间。包括：网页重定向的耗时、检查本地缓存的耗时、DNS查询的耗时、TCP连接的耗时、dom 加载完成的时间、页面 load 的总耗时等。performance.timing 是 PerformanceTiming 对象的实例。下面我们通过了解 performance.timing 各个字段的意思来实现下面图片的功能。">
        <meta name="keywords" content="浏览器输入 url 到页面显示全过程,performance.timing各字段详解">

        <title>通过 performance.timing 简单理解浏览器输入 url 到页面显示全过程 - 左小白的技术日常</title>
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link href="/lib/prismjs/prism_default.css" rel="stylesheet" />
        <link href="/lib/notes.css" rel="stylesheet" />
        <link rel="stylesheet" href="/lib/global.css">
        
      </head>
      <body>
        <header>
          <div>
            <img src="/images/logo.png" width="24" height="24" class="pointer" onclick="gotoIndex()" />
            <span class="pointer" onclick="gotoIndex()">左小白的技术日常</span>
            <span class="hidden"> | </span>
            <a href="/blog/category.html#javascript" class="hidden">JavaScript</a>
          </div>
          <div>
            
          <a href="http://fe.zuo11.com" target="_black" class="hidden">我的笔记</a>
        
          <a href="https://github.com/zuoxiaobai" target="_black" class="">Github</a>
        
          </div>
        </header>
        <section class="content">
          <article>
            <h1 id="通过-performancetiming-简单理解浏览器输入-url-到页面显示全过程">通过 performance.timing 简单理解浏览器输入 url 到页面显示全过程</h1>
            
    <div class="article-top">
      <div class="flex">
        这篇文章发布于 2020/12/30，归类于 <a href="/blog/category.html#javascript" class="hidden">JavaScript</a>
        <!-- ，阅读 11 次，今日 1 次 <div class="top-comment">4 条评论</div> -->
        <div id="readAndComment" class="flex"></div>
      </div> 
      <div class="flex keywords" style="flex-wrap: nowrap;">
        <div style="flex-shrink:0; align-self: flex-start;">标签：</div>
        <div class="flex" style="flex-wrap: wrap;"><span>浏览器输入 url 到页面显示全过程</span>，<span>performance.timing各字段详解</span></div>
      </div>
    </div>
    
  
            
<p>performance.timing 记录了在浏览器中输入 url 到页面显示整个过程中各个关键节点的时间。包括：网页重定向的耗时、检查本地缓存的耗时、DNS查询的耗时、TCP连接的耗时、dom 加载完成的时间、页面 load 的总耗时等。performance.timing 是 PerformanceTiming 对象的实例。下面我们通过了解 performance.timing 各个字段的意思来实现下面图片的功能。</p>
<p><img src="../../../images/blog/js/jianshu_timing.png" alt="jianshu_timing.png"></p>
<p>首先我们来看一张非常重要的图，下图是页面打开过程中 performance.timing 各字段所在的位置</p>
<p><img src="../../../images/blog/js/performance.png" alt="performance.png"></p>
<p>按照顺序对各个字段的解释：</p>
<ul>
<li><code>navigationStart: 1607492537332</code> 同一个浏览器上一个页面卸载结束时的时间戳。如果没有上一个页面的话，那么该值会和 fetchStart 的值相同。</li>
<li><code>redirectStart: 0</code> 第一个 HTTP 重定向开始的时间戳。如果没有重定向，或者重定向到一个不同源的话，那么该值返回为 0。</li>
<li><code>redirectEnd: 0</code> 最后一个 HTTP 重定向完成时的时间戳。如果没有重定向，或者重定向到一个不同的源，该值也返回为 0。</li>
<li><code>fetchStart: 1607492537338</code> 浏览器准备好使用 http 请求的时间(发生在检查本地缓存之前)。</li>
<li><code>domainLookupStart: 1607492537349</code> DNS 域名查询开始的时间，如果使用了本地缓存（即无 DNS 查询）或持久连接，则与 fetchStart 值相等</li>
<li><code>domainLookupEnd: 1607492537403</code> DNS 域名查询结束的时间，如果使用了本地缓存（即无 DNS 查询）或持久连接，则与 fetchStart 值相等</li>
<li><code>connectStart: 1607492537403</code> HTTP（TCP）开始/重新 建立连接的时间，如果是持久连接，则与 fetchStart 值相等。</li>
<li><code>secureConnectionStart: 1607492537472</code> HTTPS 连接开始的时间，如果不是安全连接，则值为 0。</li>
<li><code>connectEnd: 1607492537600</code> HTTP（TCP） 完成建立连接的时间（完成握手），如果是持久连接，则与 fetchStart 值相等。</li>
<li><code>requestStart: 1607492537601</code> HTTP 请求读取真实文档开始的时间（完成建立连接），包括从本地读取缓存。</li>
<li><code>responseStart: 1607492537841</code>  HTTP 开始接收响应的时间（获取到第一个字节），包括从本地读取缓存。</li>
<li><code>responseEnd: 1607492537996</code> HTTP 响应全部接收完成的时间（获取到最后一个字节），包括从本地读取缓存。</li>
<li><code>unloadEventStart: 0</code> 前一个网页（和当前页面同域）unload的时间戳，如果没有前一个网页或前一个网页是不同的域的话，那么该值为0.</li>
<li><code>unloadEventEnd: 0</code> 前一个页面 unload 时间绑定的回掉函数执行完毕的时间戳。</li>
<li><code>domLoading: 1607492537852</code> 开始解析渲染 DOM 树的时间，此时 Document.readyState 变为 loading，并将抛出 readystatechange 相关事件。</li>
<li><code>domInteractive: 1607492538002</code>  完成解析 DOM 树的时间，Document.readyState 变为 interactive，并将抛出 readystatechange 相关事件，注意只是 DOM 树解析完成，这时候并没有开始加载网页内的资源。</li>
<li><code>domContentLoadedEventStart: 1607492538002</code> DOM 解析完成后，网页内资源加载开始的时间，在 DOMContentLoaded 事件抛出前发生。</li>
<li><code>domContentLoadedEventEnd: 1607492538002</code> DOM 解析完成后，网页内资源加载完成的时间（如 JS 脚本加载执行完毕）。</li>
<li><code>domComplete: 1607492544648</code> DOM 树解析完成，且资源也准备就绪的时间，Document.readyState 变为 complete，并将抛出 readystatechange 相关事件。</li>
<li><code>loadEventStart: 1607492544648</code> load 事件发送给文档，也即 load 回调函数开始执行的时间。如果没有绑定load事件，该值为0.</li>
<li><code>loadEventEnd: 1607492544653</code> load 事件的回调函数执行完毕的时间。如果没有绑定load事件，该值为0.</li>
</ul>
<p>结合上面的各字段含义以及页面打开过程图，我们可以实现一个简单的计算页面耗时函数</p>
<pre><code class="language-js">function getPerfermanceTiming() {
  let t = performance.timing

  // 重定向结束时间 - 重定向开始时间
  let redirect = t.redirectEnd - t.redirectStart
  // DNS 查询开始时间 - fetech start 时间
  let appCache = t.domainLookupStart - t.fetchStart
  // DNS 查询结束时间 - DNS 查询开始时间
  let dns = t.domainLookupEnd - t.domainLookupStart
  // 完成 TCP 连接握手时间 - TCP 连接开始时间 
  let tcp = t.connectEnd - t.connectStart
  // 从请求开始到接收到第一个响应字符的时间 
  let ttfb = t.responseStart - t.requestStart
  // 资源下载时间，响应结束时间 - 响应开始时间
  let contentDL = t.responseEnd - t.responseStart
  // 从请求开始到响应结束的时间
  let httpTotal = t.responseEnd - t.requestStart
  // 从页面开始到 domContentLoadedEventEnd
  let domContentloaded = t.domContentLoadedEventEnd - t.navigationStart
  // 从页面开始到 loadEventEnd
  let loaded = t.loadEventEnd - t.navigationStart

  let result = [
    { key: &quot;Redirect&quot;, desc: &quot;网页重定向的耗时&quot;, value: redirect }, 
    { key: &quot;AppCache&quot;, desc: &quot;检查本地缓存的耗时&quot;, value: appCache },
    { key: &quot;DNS&quot;, desc: &quot;DNS查询的耗时&quot;, value: dns },
    { key: &quot;TCP&quot;, desc: &quot;TCP连接的耗时&quot;, value: tcp },
    { key: &quot;Waiting(TTFB)&quot;, desc: &quot;从客户端发起请求到接收到响应的时间 / Time To First Byte&quot;, value: ttfb },
    { key: &quot;Content Download&quot;, desc: &quot;下载服务端返回数据的时间&quot;, value: contentDL },
    { key: &quot;HTTP Total Time&quot;, desc: &quot;http请求总耗时&quot;, value: httpTotal },
    { key: &quot;DOMContentLoaded&quot;, desc: &quot;dom加载完成的时间&quot;, value: domContentloaded },
    { key: &quot;Loaded&quot;, desc: &quot;页面load的总耗时&quot;, value: loaded }
  ]
  return result
}
getPerfermanceTiming()</code></pre>
<p>参考: </p>
<ul>
<li><a href="https://blog.csdn.net/z9061/article/details/101454438">Web 性能优化-首屏和白屏时间</a></li>
<li><a href="https://www.jianshu.com/p/1355232d525a">Performance --- 前端性能监控</a></li>
<li><a href="http://fe.zuo11.com/js/ad3/js-ad3-20.html#%E8%AE%A1%E6%97%B6-api-performace%E6%80%A7%E8%83%BD">计时 API（Performace性能）- 20. JavaScript API - JS高程4笔记</a></li>
<li><a href="https://www.jianshu.com/p/dd07cca0a48e">该函数实现是对简书 console 内容的模仿实现</a></li>
</ul>

            
            <ins class='adsbygoogle' style='display:block;margin-top:1em;margin-bottom:0' data-ad-format='fluid' data-ad-layout-key='-gw-3+1f-3d+2z' data-ad-client='ca-pub-9527676606416641' data-ad-slot='8870245163'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            <!-- 评论系统占位 -->
            <div id="commentDiv"></div>
          </article>

          <aside>
            <div class="aside-wrap">
              <div class="top ">
                <ul><li><span class="ul-span" data-id="通过-performancetiming-简单理解浏览器输入-url-到页面显示全过程" style="padding-left:1em">通过 performance.timing 简单理解浏览器输入 url 到页面显示全过程<span></li></ul>
              </div>
              <ins class='adsbygoogle' style='display:block;width:300px;height:250px;' data-ad-client='ca-pub-9527676606416641' data-ad-slot='9476232907'></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
          </aside>
        </section>
        <footer>
          <div class="footer_content">
            <div class="footer_right">Copyright © 2016-2020 zuo11.com. <a href='http://beian.miit.gov.cn/'>鄂ICP备16014741号-1</a></div>
            <div>Powered by <a href='https://github.com/zuoxiaobai/zuo-blog' target='_black'>zuo-blog</a></div>
          </div>
        </footer>
        <script src="/lib/prismjs/prism_default.js"></script>
        <script src="/lib/notes.js"></script> 
        <script src="/lib/global.js"></script>
        <script>
          
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?183281668cc3440449274d1f93c04de6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-178732583-1"></script> -->
<script>
  // window.dataLayer = window.dataLayer || [];
  // function gtag(){dataLayer.push(arguments);}
  // gtag('js', new Date());
  // gtag('config', 'UA-178732583-1');

  window.onload = function() {
    setTimeout(function() {
      let script = document.createElement("script");
      script.setAttribute("data-ad-client", "ca-pub-9527676606416641");
      script.setAttribute("async", "");
      script.src = "//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js";
      document.body.appendChild(script);
    }, 200);
  }
</script>

      </body>
    </html>
  