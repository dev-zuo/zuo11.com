<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>配置</title>
</head>
<body>
  <div>当前mark值: <span id="mark"></span></div>
  <button style="display:none" id="editmark" onclick="editmarkClick()">修改mark值</button>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>

    let core = null

    window.onload = async () => {
      core = new Core()
      core.setConfigToDom()
    }

    function editmarkClick() {
      core.editMark()
    }

    function Core() {
      this.mark = ''
      this.id = ''
    }

    Core.prototype.getConfig = async () => {
      try {
        let res = await axios.get('/ibd/fooddaily/info')
        console.log(res)
        return res.data.data
      } catch(e) {
        alert(e.message)
        console.error(e)
      }
    }

    // 获取config里的值，并赋值一个mark变量，并显示到dom，显示修改按钮
    // Core.prototype.setConfigToDom = async () =>  {
    Core.prototype.setConfigToDom = async function () {
      // 从接口获取config
      let data = await this.getConfig()
      // 设置到core的实例变量上
      this.mark = data.auditMark;
      this.id = data.id

      // 将值设置到dom上
      let markElement = document.getElementById('mark')
      markElement.innerText = this.mark

      // 显示修改按钮
      this.showButton()
    }

    Core.prototype.showButton = () => {
      let buttonEle = document.getElementById('editmark')
      // console.log(buttonEle.style.display)
      buttonEle.style.display = 'block'
    }

    Core.prototype.editMark = async function () {
      console.log('editmark')
      console.log(this.mark)
      try {
        let res = await axios.put('/ibd/fooddaily/info', {
          auditMark: this.mark === 1 ? 0 : 1,
          id: this.id
        })
        console.log(res)
        this.setConfigToDom()
      } catch(e) {
        alert(e.message)
        cosnole.error(e)
      }
    }

  </script>
</body>
</html>